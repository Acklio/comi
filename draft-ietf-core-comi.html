<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" 
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">

<html lang="en" xmlns="http://www.w3.org/1999/xhtml" xml:lang="en">
<head profile="http://www.w3.org/2006/03/hcard http://dublincore.org/documents/2008/08/04/dc-html/">
  <meta http-equiv="Content-Type" content="text/html; charset=us-ascii" />

  <title>CoAP Management Interface</title>

  
<style type="text/css">/*<![CDATA[*/
@viewport {
  zoom: 1.0;
  width: extend-to-zoom;
}
@-ms-viewport {
  width: extend-to-zoom;
  zoom: 1.0;
}

@media screen and (min-width: 1024px) {
  ul.toc, #rfc\.toc {
    position: fixed;
    bottom: 0;
    right: 0;
    right: calc(50vw - 500px);
    width: 300px;
    padding: 0 1em;
    z-index: 1;
  }
  #rfc\.toc {
    top: 16px;
  }
  ul.toc {
    top: 80px;
    overflow: auto;
  }

  body {
    padding-left: 1.5em;
    padding-right: 29em;
  }
}

body {
  font: 15px "Helvetica Neue",Helvetica,Arial,sans-serif;
  color: #333;
  font-size-adjust: 0.5;
  line-height: 130%;
  margin: 2.5em auto;
  max-width: 724px;
}

.title, .filename, h1, h2, h3, h4 {
  font-family: "Helvetica Neue",Helvetica,Arial,sans-serif;
  font-size-adjust: 0.5;
  font-weight: 500;
  color: #333;
  line-height: 100%;
  margin: 0.8em 0 0.3em;
}
.title { font-size: 36px; }
h1 { font-size: 30px; }
h2 { font-size: 24px; }
h3, h4 { font-size: 18px; }
h1 a[href], h2 a[href], h3 a[href], h4 a[href] {
  color: #333;
}

ul.toc li {
  list-style: none;
  text-indent: -2.5em;
  padding-left: 2.5em;
  padding-bottom: 5px;
  margin: 0;
}
ul.toc ul {
  margin: 0;
}
/* xml2rfc nests ul directly inside ul which messes with the style badly */
ul.toc, ul.toc>ul, ul.toc ul>ul {
  margin: 0 0 0 1.5em;
}

table {
  margin-left: 0em;
  border-collapse: collapse;
}
th {
  text-align: left;
  border-bottom: 2px solid #ddd;
}
td {
  border-top: 1px solid #ddd;
  vertical-align: top;
}
tr:nth-child(2n+1) > td,
tr:nth-child(2n+1) > th {
  background-color: #f9f9f9;
}
td.reference {
  max-width: 200px;
  border-top: none;
  padding-right: 1em;
}
.right {
  text-align: right;
}


table.header {
  width: 100%;
}
table.header td {
  border: none;
  background-color: transparent;
  color: black;
}
.filename {
  color: rgb(119, 119, 119);
  font-size: 23px;
  font-weight: normal;
  height: auto;
  line-height: 100%;
}
#rfc\.abstract+p {
  font-size: 20px;
  font-weight: 300;
  line-height: 130%;
}

samp, tt, code, pre {
  font: 11pt consolas, monospace;
  font-size-adjust: none;
}
pre {
  background-color: #eee;
  border: 1px solid #ddd;
  overflow-x: auto;
  padding: 5px;
  margin: 5px;
}
.figure {
  font-style: italic;
  margin: 0 1.5em;
}

address {
  margin: 10px 0 0;
}
.vcard {
  font-style: normal;
}
.vcardline {
  display: block;
}
.vcardline .fn {
  font-weight: bold;
}
.vcardline .hidden {
  display: none;
}

dl {
  margin-left: 1em;
}
dl.dl-horizontal: {
  margin-left: 0;
}
dl > dt {
  float: left;
  margin-right: 1em;
}
dl.nohang > dt {
  float: none;
}
dl > dd {
  margin-bottom: .5em;
}
dl.compact > dd {
  margin-bottom: 0em;
}
dl > dd > dl {
  margin-top: 0.5em;
  margin-bottom: 0em;
}
ul.empty {
  list-style-type: none;
}
ul.empty li {
  margin-top: .5em;
}

hr {
  border: 0;
  border-top: 1px solid #eee;
}

a {
  text-decoration: none;
}
a[href] {
  color: #2a6496;
}
a[href]:hover {
  background-color: #eee;
}

ol, ul, li, p {
  padding: 0;
  margin: 0.5em 0 0.5em 2em;
}
li, p {
  margin-left: 0;
}
address {
  font-style: normal;
}

.github-fork-ribbon-wrapper {
  display: none;
}
@media screen and (min-width: 800px) {
  /* "Fork me on GitHub" CSS ribbon based on
   * https://github.com/simonwhitaker/github-fork-ribbon-css
   */
  .github-fork-ribbon {
    position: absolute;
    padding: 2px 0;
    background-color: #a00;
    background-image: linear-gradient(to bottom, rgba(0, 0, 0, 0), rgba(0, 0, 0, 0.15));
    box-shadow: 0 2px 3px 0 rgba(0, 0, 0, 0.5);
    font: 700 12px "Helvetica Neue", Helvetica, Arial, sans-serif;

    pointer-events: auto;

    top: 38px;
    right: -45px;

    transform: rotate(45deg);
  }

  .github-fork-ribbon a[href],
  .github-fork-ribbon a[href]:hover {
    color: #fff;
    background-color: transparent;
    text-decoration: none;
    text-shadow: 0 -1px rgba(0, 0, 0, 0.5);
    text-align: center;

    width: 190px;
    line-height: 18px;

    display: inline-block;
    padding: 2px 0;

    border: 1.5px dotted #fff;
    border-color: rgba(255, 255, 255, 0.6);
  }

  .github-fork-ribbon-wrapper {
    display: block;
    width: 130px;
    height: 130px;
    position: absolute;
    overflow: hidden;
    top: 0; right: 0;
    z-index: 2;
    pointer-events: none;
  }
}
@media screen and (min-width: 1000px) {
  .github-fork-ribbon-wrapper {
    position: fixed;
  }
/*]]>*/</style>


  <link href="#rfc.toc" rel="Contents"/>
<link href="#rfc.section.1" rel="Chapter" title="1 Introduction"/>
<link href="#rfc.section.1.1" rel="Chapter" title="1.1 Terminology"/>
<link href="#rfc.section.2" rel="Chapter" title="2 CoMI Architecture"/>
<link href="#rfc.section.2.1" rel="Chapter" title="2.1 Major differences between RESTCONF and CoMI"/>
<link href="#rfc.section.2.2" rel="Chapter" title="2.2 Compression of YANG identifiers"/>
<link href="#rfc.section.3" rel="Chapter" title="3 Example syntax"/>
<link href="#rfc.section.4" rel="Chapter" title="4 CoAP Interface"/>
<link href="#rfc.section.5" rel="Chapter" title="5 /c Function Set"/>
<link href="#rfc.section.5.1" rel="Chapter" title="5.1 Using the &#x2018;k&#x2019; query parameter"/>
<link href="#rfc.section.5.2" rel="Chapter" title="5.2 Data Retrieval"/>
<link href="#rfc.section.5.2.1" rel="Chapter" title="5.2.1 Using the &#x2018;c&#x2019; query parameter"/>
<link href="#rfc.section.5.2.2" rel="Chapter" title="5.2.2 Using the &#x2018;d&#x2019; query parameter"/>
<link href="#rfc.section.5.2.3" rel="Chapter" title="5.2.3 GET"/>
<link href="#rfc.section.5.2.4" rel="Chapter" title="5.2.4 FETCH"/>
<link href="#rfc.section.5.3" rel="Chapter" title="5.3 Data Editing"/>
<link href="#rfc.section.5.3.1" rel="Chapter" title="5.3.1 Data Ordering"/>
<link href="#rfc.section.5.3.2" rel="Chapter" title="5.3.2 POST"/>
<link href="#rfc.section.5.3.3" rel="Chapter" title="5.3.3 PUT"/>
<link href="#rfc.section.5.3.4" rel="Chapter" title="5.3.4 iPATCH"/>
<link href="#rfc.section.5.3.5" rel="Chapter" title="5.3.5 DELETE"/>
<link href="#rfc.section.5.4" rel="Chapter" title="5.4 Full Data Store access"/>
<link href="#rfc.section.5.4.1" rel="Chapter" title="5.4.1 Full Data Store examples"/>
<link href="#rfc.section.5.5" rel="Chapter" title="5.5 Notify functions"/>
<link href="#rfc.section.5.5.1" rel="Chapter" title="5.5.1 Notify Examples"/>
<link href="#rfc.section.5.6" rel="Chapter" title="5.6 RPC statements"/>
<link href="#rfc.section.5.6.1" rel="Chapter" title="5.6.1 RPC Example"/>
<link href="#rfc.section.6" rel="Chapter" title="6 Access to MIB Data"/>
<link href="#rfc.section.7" rel="Chapter" title="7 Use of Block"/>
<link href="#rfc.section.8" rel="Chapter" title="8 Resource Discovery"/>
<link href="#rfc.section.9" rel="Chapter" title="9 Error Handling"/>
<link href="#rfc.section.10" rel="Chapter" title="10 Security Considerations"/>
<link href="#rfc.section.11" rel="Chapter" title="11 IANA Considerations"/>
<link href="#rfc.section.12" rel="Chapter" title="12 Acknowledgements"/>
<link href="#rfc.section.13" rel="Chapter" title="13 Changelog"/>
<link href="#rfc.references" rel="Chapter" title="14 References"/>
<link href="#rfc.references.1" rel="Chapter" title="14.1 Normative References"/>
<link href="#rfc.references.2" rel="Chapter" title="14.2 Informative References"/>
<link href="#rfc.appendix.A" rel="Chapter" title="A YANG example specifications"/>
<link href="#rfc.appendix.A.1" rel="Chapter" title="A.1 ietf-system"/>
<link href="#rfc.appendix.A.2" rel="Chapter" title="A.2 server list"/>
<link href="#rfc.appendix.A.3" rel="Chapter" title="A.3 interfaces"/>
<link href="#rfc.appendix.A.4" rel="Chapter" title="A.4 Example-port"/>
<link href="#rfc.appendix.A.5" rel="Chapter" title="A.5 IP-MIB"/>
<link href="#rfc.appendix.B" rel="Chapter" title="B Comparison with LWM2M"/>
<link href="#rfc.appendix.B.1" rel="Chapter" title="B.1 Introduction"/>
<link href="#rfc.appendix.B.2" rel="Chapter" title="B.2 Defining Management Resources"/>
<link href="#rfc.appendix.B.3" rel="Chapter" title="B.3 Identifying Management Resources"/>
<link href="#rfc.appendix.B.4" rel="Chapter" title="B.4 Encoding of Management Resources"/>
<link href="#rfc.authors" rel="Chapter"/>


  <meta name="generator" content="xml2rfc version 2.5.2 - http://tools.ietf.org/tools/xml2rfc" />
  <link rel="schema.dct" href="http://purl.org/dc/terms/" />

  <meta name="dct.creator" content="van der Stok, P., Bierman, A., Veillette, M., and A. Pelov" />
  <meta name="dct.identifier" content="urn:ietf:id:draft-ietf-core-comi-latest" />
  <meta name="dct.issued" scheme="ISO8601" content="2017-2-01" />
  <meta name="dct.abstract" content="This document describes a network management interface for constrained devices and networks, called CoAP Management Interface (CoMI).  The Constrained Application Protocol (CoAP) is used to access data resources specified in YANG, or SMIv2 converted to YANG. CoMI uses the YANG to CBOR mapping and converts YANG identifier strings to numeric identifiers for payload size reduction.  CoMI extends the set of YANG based protocols, NETCONF and RESTCONF, with the capability to manage constrained devices and networks." />
  <meta name="description" content="This document describes a network management interface for constrained devices and networks, called CoAP Management Interface (CoMI).  The Constrained Application Protocol (CoAP) is used to access data resources specified in YANG, or SMIv2 converted to YANG. CoMI uses the YANG to CBOR mapping and converts YANG identifier strings to numeric identifiers for payload size reduction.  CoMI extends the set of YANG based protocols, NETCONF and RESTCONF, with the capability to manage constrained devices and networks." />

</head>

<body>

  <table class="header">
    <tbody>
    
    	<tr>
  <td class="left">CoRE</td>
  <td class="right">P. van der Stok</td>
</tr>
<tr>
  <td class="left">Internet-Draft</td>
  <td class="right">consultant</td>
</tr>
<tr>
  <td class="left">Intended status: Standards Track</td>
  <td class="right">A. Bierman</td>
</tr>
<tr>
  <td class="left">Expires: August 5, 2017</td>
  <td class="right">YumaWorks</td>
</tr>
<tr>
  <td class="left"></td>
  <td class="right">M. Veillette</td>
</tr>
<tr>
  <td class="left"></td>
  <td class="right">Trilliant Networks Inc.</td>
</tr>
<tr>
  <td class="left"></td>
  <td class="right">A. Pelov</td>
</tr>
<tr>
  <td class="left"></td>
  <td class="right">Acklio</td>
</tr>
<tr>
  <td class="left"></td>
  <td class="right">February 01, 2017</td>
</tr>

    	
    </tbody>
  </table>

  <p class="title">CoAP Management Interface<br />
  <span class="filename">draft-ietf-core-comi-latest</span></p>
  
  <h1 id="rfc.abstract">
  <a href="#rfc.abstract">Abstract</a>
</h1>
<p>This document describes a network management interface for constrained devices and networks, called CoAP Management Interface (CoMI).  The Constrained Application Protocol (CoAP) is used to access data resources specified in YANG, or SMIv2 converted to YANG. CoMI uses the YANG to CBOR mapping and converts YANG identifier strings to numeric identifiers for payload size reduction.  CoMI extends the set of YANG based protocols, NETCONF and RESTCONF, with the capability to manage constrained devices and networks.</p>
<h1>
  <a>Note</a>
</h1>
<p>Discussion and suggestions for improvement are requested, and should be sent to core@ietf.org.</p>
<h1 id="rfc.status">
  <a href="#rfc.status">Status of This Memo</a>
</h1>
<p>This Internet-Draft is submitted in full conformance with the provisions of BCP 78 and BCP 79.</p>
<p>Internet-Drafts are working documents of the Internet Engineering Task Force (IETF).  Note that other groups may also distribute working documents as Internet-Drafts.  The list of current Internet-Drafts is at http://datatracker.ietf.org/drafts/current/.</p>
<p>Internet-Drafts are draft documents valid for a maximum of six months and may be updated, replaced, or obsoleted by other documents at any time.  It is inappropriate to use Internet-Drafts as reference material or to cite them other than as "work in progress."</p>
<p>This Internet-Draft will expire on August 5, 2017.</p>
<h1 id="rfc.copyrightnotice">
  <a href="#rfc.copyrightnotice">Copyright Notice</a>
</h1>
<p>Copyright (c) 2017 IETF Trust and the persons identified as the document authors.  All rights reserved.</p>
<p>This document is subject to BCP 78 and the IETF Trust's Legal Provisions Relating to IETF Documents (http://trustee.ietf.org/license-info) in effect on the date of publication of this document.  Please review these documents carefully, as they describe your rights and restrictions with respect to this document.  Code Components extracted from this document must include Simplified BSD License text as described in Section 4.e of the Trust Legal Provisions and are provided without warranty as described in the Simplified BSD License.</p>

  
  <hr class="noprint" />
  <h1 class="np" id="rfc.toc"><a href="#rfc.toc">Table of Contents</a></h1>
  <ul class="toc">

  	<li>1.   <a href="#rfc.section.1">Introduction</a></li>
<ul><li>1.1.   <a href="#rfc.section.1.1">Terminology</a></li>
</ul><li>2.   <a href="#rfc.section.2">CoMI Architecture</a></li>
<ul><li>2.1.   <a href="#rfc.section.2.1">Major differences between RESTCONF and CoMI</a></li>
<li>2.2.   <a href="#rfc.section.2.2">Compression of YANG identifiers</a></li>
</ul><li>3.   <a href="#rfc.section.3">Example syntax</a></li>
<li>4.   <a href="#rfc.section.4">CoAP Interface</a></li>
<li>5.   <a href="#rfc.section.5">/c Function Set</a></li>
<ul><li>5.1.   <a href="#rfc.section.5.1">Using the &#8216;k&#8217; query parameter</a></li>
<li>5.2.   <a href="#rfc.section.5.2">Data Retrieval</a></li>
<ul><li>5.2.1.   <a href="#rfc.section.5.2.1">Using the &#8216;c&#8217; query parameter</a></li>
<li>5.2.2.   <a href="#rfc.section.5.2.2">Using the &#8216;d&#8217; query parameter</a></li>
<li>5.2.3.   <a href="#rfc.section.5.2.3">GET</a></li>
<li>5.2.4.   <a href="#rfc.section.5.2.4">FETCH</a></li>
</ul><li>5.3.   <a href="#rfc.section.5.3">Data Editing</a></li>
<ul><li>5.3.1.   <a href="#rfc.section.5.3.1">Data Ordering</a></li>
<li>5.3.2.   <a href="#rfc.section.5.3.2">POST</a></li>
<li>5.3.3.   <a href="#rfc.section.5.3.3">PUT</a></li>
<li>5.3.4.   <a href="#rfc.section.5.3.4">iPATCH</a></li>
<li>5.3.5.   <a href="#rfc.section.5.3.5">DELETE</a></li>
</ul><li>5.4.   <a href="#rfc.section.5.4">Full Data Store access</a></li>
<ul><li>5.4.1.   <a href="#rfc.section.5.4.1">Full Data Store examples</a></li>
</ul><li>5.5.   <a href="#rfc.section.5.5">Notify functions</a></li>
<ul><li>5.5.1.   <a href="#rfc.section.5.5.1">Notify Examples</a></li>
</ul><li>5.6.   <a href="#rfc.section.5.6">RPC statements</a></li>
<ul><li>5.6.1.   <a href="#rfc.section.5.6.1">RPC Example</a></li>
</ul></ul><li>6.   <a href="#rfc.section.6">Access to MIB Data</a></li>
<li>7.   <a href="#rfc.section.7">Use of Block</a></li>
<li>8.   <a href="#rfc.section.8">Resource Discovery</a></li>
<li>9.   <a href="#rfc.section.9">Error Handling</a></li>
<li>10.   <a href="#rfc.section.10">Security Considerations</a></li>
<li>11.   <a href="#rfc.section.11">IANA Considerations</a></li>
<li>12.   <a href="#rfc.section.12">Acknowledgements</a></li>
<li>13.   <a href="#rfc.section.13">Changelog</a></li>
<li>14.   <a href="#rfc.references">References</a></li>
<ul><li>14.1.   <a href="#rfc.references.1">Normative References</a></li>
<li>14.2.   <a href="#rfc.references.2">Informative References</a></li>
</ul><li>Appendix A.   <a href="#rfc.appendix.A">YANG example specifications</a></li>
<ul><li>A.1.   <a href="#rfc.appendix.A.1">ietf-system</a></li>
<li>A.2.   <a href="#rfc.appendix.A.2">server list</a></li>
<li>A.3.   <a href="#rfc.appendix.A.3">interfaces</a></li>
<li>A.4.   <a href="#rfc.appendix.A.4">Example-port</a></li>
<li>A.5.   <a href="#rfc.appendix.A.5">IP-MIB</a></li>
</ul><li>Appendix B.   <a href="#rfc.appendix.B">Comparison with LWM2M</a></li>
<ul><li>B.1.   <a href="#rfc.appendix.B.1">Introduction</a></li>
<li>B.2.   <a href="#rfc.appendix.B.2">Defining Management Resources</a></li>
<li>B.3.   <a href="#rfc.appendix.B.3">Identifying Management Resources</a></li>
<li>B.4.   <a href="#rfc.appendix.B.4">Encoding of Management Resources</a></li>
</ul><li><a href="#rfc.authors">Authors' Addresses</a></li>


  </ul>

  <h1 id="rfc.section.1"><a href="#rfc.section.1">1.</a> <a href="#introduction" id="introduction">Introduction</a></h1>
<p id="rfc.section.1.p.1">The Constrained Application Protocol (CoAP) <a href="#RFC7252">[RFC7252]</a> is designed for Machine to Machine (M2M) applications such as smart energy and building control.  Constrained devices need to be managed in an automatic fashion to handle the large quantities of devices that are expected in future installations. The messages between devices need to be as small and infrequent as possible. The implementation complexity and runtime resources need to be as small as possible.</p>
<p id="rfc.section.1.p.2">This draft describes the CoAP Management Interface which uses CoAP methods to access structured data defined in YANG <a href="#RFC7950">[RFC7950]</a>. This draft is complementary to the draft <a href="#I-D.ietf-netconf-restconf">[I-D.ietf-netconf-restconf]</a> which describes a REST-like interface called RESTCONF, which uses HTTP methods to access structured data defined in YANG.</p>
<p id="rfc.section.1.p.3">The use of standardized data sets, specified in a standardized language such as YANG, promotes interoperability between devices and applications from different manufacturers.  A large amount of  Management Information Base (MIB) <a href="#mibreg">[mibreg]</a> specifications already exists for monitoring purposes. This data can be accessed in RESTCONF or CoMI if the server converts the SMIv2 modules to YANG, using the mapping rules defined in <a href="#RFC6643">[RFC6643]</a>.</p>
<p id="rfc.section.1.p.4">CoMI and RESTCONF are intended to work in a stateless client-server fashion.  They use a single round-trip to complete a single editing transaction, where NETCONF needs up to 10 round trips.</p>
<p id="rfc.section.1.p.5">To promote small packets, CoMI uses a YANG to CBOR mapping <a href="#I-D.ietf-core-yang-cbor">[I-D.ietf-core-yang-cbor]</a> and numeric identifiers <a href="#I-D.ietf-core-sid">[I-D.ietf-core-sid]</a> to minimize CBOR payloads and URI length.</p>
<h1 id="rfc.section.1.1"><a href="#rfc.section.1.1">1.1.</a> <a href="#terminology" id="terminology">Terminology</a></h1>
<p id="rfc.section.1.1.p.1">The key words &#8220;MUST&#8221;, &#8220;MUST NOT&#8221;, &#8220;REQUIRED&#8221;, &#8220;SHALL&#8221;, &#8220;SHALL NOT&#8221;, &#8220;SHOULD&#8221;, &#8220;SHOULD NOT&#8221;, &#8220;RECOMMENDED&#8221;, &#8220;MAY&#8221;, and &#8220;OPTIONAL&#8221; in this document are to be interpreted as described in <a href="#RFC2119">[RFC2119]</a>.</p>
<p id="rfc.section.1.1.p.2">Readers of this specification should be familiar with all the terms and concepts discussed in <a href="#RFC3410">[RFC3410]</a>, <a href="#RFC3416">[RFC3416]</a>, and <a href="#RFC2578">[RFC2578]</a>.</p>
<p id="rfc.section.1.1.p.3">The following terms are defined in the NETCONF protocol <a href="#RFC6241">[RFC6241]</a>: client, configuration data, datastore, and server.</p>
<p id="rfc.section.1.1.p.4">The following terms are defined in the YANG data modelling language <a href="#RFC7950">[RFC7950]</a>: anydata, anyxml, container, data node, key, key leaf, leaf, leaf-list, and list.</p>
<p id="rfc.section.1.1.p.5">The following terms are defined in RESTCONF protocol <a href="#I-D.ietf-netconf-restconf">[I-D.ietf-netconf-restconf]</a>: data resource, datastore resource, edit operation, query parameter, and target resource.</p>
<p id="rfc.section.1.1.p.6">The following terms are defined in this document:</p>
<p/>

<dl>
  <dt>data node instance:</dt>
  <dd style="margin-left: 8">An instance of a data node specified in a YANG module present in the server.  The instance is stored in the memory of the server.</dd>
  <dt>Notification instance:</dt>
  <dd style="margin-left: 8">An instance of a schema node of type notification, specified in a YANG module present in the server. The instance is generated in the server at the occurrence of the corresponding event and appended to a stream.</dd>
  <dt>YANG schema item identifier:</dt>
  <dd style="margin-left: 8">Numeric identifier which replaces the name identifying a YANG item (see section 6.2 of <a href="#RFC7950">[RFC7950]</a>) (anydata, anyxml, data node, RPC, Action, Notification, Identity, Module name, Submodule name, Feature).</dd>
  <dt>list instance identifier:</dt>
  <dd style="margin-left: 8">Handle used to identify a YANG data node that is an instance of a YANG &#8220;list&#8221; specified with the values of the key leaves of the list.</dd>
  <dt>single instance identifier:</dt>
  <dd style="margin-left: 8">Handle used to identify a specific data node which can be instantiated only once. This includes data nodes defined at the root of a YANG module or submodule and data nodes defined within a container. This excludes data nodes defined within a list or any children of these data nodes.</dd>
  <dt>instance identifier:</dt>
  <dd style="margin-left: 8">List instance identifier or single instance identifier.</dd>
  <dt>data node value:</dt>
  <dd style="margin-left: 8">Value assigned to a data node instance. Data node values are encoded based on the rules defined in section 4 of <a href="#I-D.ietf-core-yang-cbor">[I-D.ietf-core-yang-cbor]</a>.</dd>
  <dt>set of data node instances:</dt>
  <dd style="margin-left: 8">Represents the payload of CoAP methods when a collection is sent or returned.  There are two possibilities, dependent on Request context: <ol><li>CBOR array of pair(s) &lt;instance identifier, data node value &gt;</li><li>CBOR map of pair(s) &lt;instance identifier, data node value &gt;</li></ol><p> TODO: Reduce to one, if possible</p></dd>
</dl>
<p id="rfc.section.1.1.p.8">The following list contains the abbreviations used in this document.</p>
<p/>

<dl>
  <dt>SID:</dt>
  <dd style="margin-left: 8">YANG Schema Item iDentifier.</dd>
</dl>
<h1 id="rfc.section.2"><a href="#rfc.section.2">2.</a> <a href="#comi-architecture" id="comi-architecture">CoMI Architecture</a></h1>
<p id="rfc.section.2.p.1">This section describes the CoMI architecture to use CoAP for the reading and modifying the content of a datastore used for the management of the instrumented node.</p>
<div id="rfc.figure.1"/>
<div id="archit"/>
<pre>
+--------------------------------------------------------------+
|                    SMIv2  specification (2)                  |
+--------------------------------------------------------------+
                              \/
+--------------------------------------------------------------+
|                    YANG  specification  (1)                  |
+---------*-----------------------------------------*----------+
          | compilation                             | compilation
          |              security (7)               |
client   \|/      [===========================]    \|/    Server
+--------------------+                       +------------------+
|                    |                       |                  |
| Request generation +--&gt; CoAP request(3) --&gt;| Request retrieval|
| answer retrieval   |&lt;-- CoAP response(3)&lt;--| answer generation|
|       (4)          |                       |       (4)        |
+--------------------+                       | +---------------+|
                                             | | datastore (5) ||
                                             | +---------------+|
                                             |                  |
                                             |      Variable    |
                                             |Instrumentation(6)|
                                             +------------------+

</pre>
<p class="figure">Figure 1: Abstract CoMI architecture</p>
<p><a href="#archit">Figure 1</a> is a high level representation of the main elements of the CoAP management architecture. A client sends requests as payload in packets over the network to a managed constrained node.</p>
<p id="rfc.section.2.p.3">The different numbered components of <a href="#archit">Figure 1</a> are discussed according to component number.</p>
<p/>

<dl>
  <dt>(1) YANG specification:</dt>
  <dd style="margin-left: 8">contains a set of named and versioned modules.</dd>
  <dt>(2) SMIv2 specification:</dt>
  <dd style="margin-left: 8">A named module specifies a set of variables and &#8220;conceptual tables&#8221;. There is an algorithm to translate SMIv2 specifications to YANG specifications.</dd>
  <dt>(3) CoMI messages:</dt>
  <dd style="margin-left: 8">The CoMI client sends request messages to and receives response messages from the CoMI server.</dd>
  <dt>(4) Retrieval, generation:</dt>
  <dd style="margin-left: 8">The server and client  parse the CoMI request/response and identify the corresponding instances in the datastore based on YANG specification.</dd>
  <dt>(5) Datastore:</dt>
  <dd style="margin-left: 8">The store is composed of two parts: Operational state and Configuration datastore.  Datastore also supports RPCs and event streams.</dd>
  <dt>(6) Variable instrumentation:</dt>
  <dd style="margin-left: 8">This code depends on implementation of drivers and other node specific aspects.</dd>
  <dt>(7) Security:</dt>
  <dd style="margin-left: 8">The server MUST prevent unauthorized users from reading or writing any data resources. CoMI relies on security protocols such as DTLS <a href="#RFC6347">[RFC6347]</a> to secure CoAP communication.</dd>
</dl>
<h1 id="rfc.section.2.1"><a href="#rfc.section.2.1">2.1.</a> <a href="#MAJDIF" id="MAJDIF">Major differences between RESTCONF and CoMI</a></h1>
<p id="rfc.section.2.1.p.1">CoMI uses CoAP/UDP as transport protocol and CBOR as payload format <a href="#I-D.ietf-core-yang-cbor">[I-D.ietf-core-yang-cbor]</a>. RESTCONF uses HTTP/TCP as transport protocol and JSON <a href="#RFC7159">[RFC7159]</a> or XML <a href="#XML">[XML]</a> as payload formats. CoMI encodes YANG identifier strings as numbers, where RESTCONF does not.</p>
<p id="rfc.section.2.1.p.2">CoMI uses the methods FETCH and iPATCH, not used by RESTCONF.  RESTCONF uses the HTTP methods HEAD, and OPTIONS, which are not used by CoMI.</p>
<p id="rfc.section.2.1.p.3">CoMI servers cannot change the order of user-ordered data. CoMI does not support insert-mode (first, last, before, after) and insertion-point (before, after) which are supported by RESTCONF.  Many CoAP servers will not support date and time functions. For that reason CoMI does not support the start, stop options for events.</p>
<p id="rfc.section.2.1.p.4">CoMI servers only implement the efficient &#8220;trim&#8221; mode for default values.</p>
<p id="rfc.section.2.1.p.5">The CoMI servers do not support the following RESTCONF functionality:</p>
<p/>

<ul>
  <li>The &#8220;fields&#8221; query parameter to query multiple instances.</li>
  <li>The &#8216;filter&#8217; query that involves XML parsing, &#8216;content&#8217;, and &#8216;depth&#8217;, query parameters.</li>
</ul>
<h1 id="rfc.section.2.2"><a href="#rfc.section.2.2">2.2.</a> <a href="#object-id-compression" id="object-id-compression">Compression of YANG identifiers</a></h1>
<p id="rfc.section.2.2.p.1">In the YANG specification items are identified with a name string. In order to significantly reduce the size of identifiers used in CoMI, numeric object identifiers are used instead of these strings.  The specific encoding of the object identifiers is not hard-wired in the protocol.</p>
<p id="rfc.section.2.2.p.2">Examples of object identifier encoding formats are described in <a href="#I-D.ietf-core-sid">[I-D.ietf-core-sid]</a>.</p>
<h1 id="rfc.section.3"><a href="#rfc.section.3">3.</a> <a href="#EXSYNTAX" id="EXSYNTAX">Example syntax</a></h1>
<p id="rfc.section.3.p.1">This section presents the notation used for the examples. The YANG specifications that are used throughout this document are shown in <a href="#EXSPEC">Appendix A</a>. The example specifications are taken over from existing modules and annotated with SIDs. The values of the SIDs are taken over from <a href="#yang-cbor">[yang-cbor]</a>.</p>
<p id="rfc.section.3.p.2">CBOR is used to encode CoMI request- and response- payloads. The CBOR syntax of the YANG payloads is specified in <a href="#RFC7049">[RFC7049]</a>. The payload examples are notated in Diagnostic notation (defined in section 6 of <a href="#RFC7049">[RFC7049]</a>) that can be automatically converted to CBOR.</p>
<p id="rfc.section.3.p.3">A YANG (item identifier, item value) pair is mapped to a CBOR (key, value) pair. The YANG item value is encoded as specified in <a href="#I-D.ietf-core-yang-cbor">[I-D.ietf-core-yang-cbor]</a>. The YANG item identifier can be a SID (single node identifier) or a CBOR array with the structure [SID, key1, key2] (list node identifier), where SID is a list identifier and the key values specify the list instance. The YANG item value can be any CBOR major type.</p>
<p id="rfc.section.3.p.4">Delta encoding is used for the SIDs. The notation +n is used when the SID has the value PREC+n where PREC is the SID of the parent container, or PREC is the SID of the preceding entity in a CBOR array.</p>
<p id="rfc.section.3.p.5">In all examples the resource path in the URI is expressed as a SID, represented as a base64 number. SIDs in the payload are represented as decimal numbers.</p>
<h1 id="rfc.section.4"><a href="#rfc.section.4">4.</a> <a href="#coap-interface" id="coap-interface">CoAP Interface</a></h1>
<p id="rfc.section.4.p.1">In CoAP a group of links can constitute a Function Set.</p>
<p id="rfc.section.4.p.2">TODO: what will happen to term Function Set ?</p>
<p id="rfc.section.4.p.3">The format of the links is specified in <a href="#I-D.ietf-core-interfaces">[I-D.ietf-core-interfaces]</a>.  This note specifies a Management Function Set. CoMI end-points that implement the CoMI management protocol support at least one discoverable management resource of resource type (rt): core.c, with path: /c, where c is short-hand for CoMI. The path root /c is recommended but not compulsory (see <a href="#discovery">Section 8</a>).</p>
<p id="rfc.section.4.p.4">The path prefix /c has resources accessible with the following three paths:</p>
<p/>

<dl>
  <dt>/c:</dt>
  <dd style="margin-left: 8">YANG-based data with path &#8220;/c&#8221; and using CBOR content encoding format.  This path represents a datastore resource which contains YANG data resources as its descendant nodes. The data nodes are identified with their SID with format /c/SID.</dd>
  <dt>/c/mod.uri:</dt>
  <dd style="margin-left: 8">URI identifying the location of the server module information, with path &#8220;/c/mod.uri&#8221; and CBOR content format. This YANG data is encoded with plain identifier strings, not YANG encoded values. An Entity Tag MUST be maintained for this resource by the server, which MUST be changed to a new value when the set of YANG modules in use by the server changes.</dd>
  <dt>/c/s:</dt>
  <dd style="margin-left: 8">String identifying the default stream resource to which YANG notification instances are appended.  Notification support is optional, so this resource will not exist if the server does not support any notifications.</dd>
</dl>
<p id="rfc.section.4.p.6">The mapping of YANG data node instances to CoMI resources is as follows: A YANG module describes a set of data trees composed of YANG data nodes.  Every data node of the YANG modules loaded in the CoMI server represents a resource of the datastore container (e.g. /c/&lt;sid&gt;</p>
<p id="rfc.section.4.p.7">When multiple instances of a list node exist, instance selection is possible as described in <a href="#FETCH">Section 5.2.4</a> and <a href="#GetExamples">Section 5.2.3.1</a>.</p>
<p id="rfc.section.4.p.8">TODO; reference to fetch and patch content formats.</p>
<p id="rfc.section.4.p.9">The profile of the management function set, with IF=core.c, is shown in the table below, following the guidelines of <a href="#I-D.ietf-core-interfaces">[I-D.ietf-core-interfaces]</a>:</p>
<table cellpadding="3" cellspacing="0" class="tt full center">
  <thead>
    <tr>
      <th class="left">name</th>
      <th class="left">path</th>
      <th class="left">rt</th>
      <th class="left">Data Type</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td class="left">Management</td>
      <td class="left">/c</td>
      <td class="left">core.c</td>
      <td class="left">n/a</td>
    </tr>
    <tr>
      <td class="left">Data</td>
      <td class="left">/c</td>
      <td class="left">core.c.data</td>
      <td class="left">application/cbor</td>
    </tr>
    <tr>
      <td class="left">Module Set URI</td>
      <td class="left">/c/mod.uri</td>
      <td class="left">core.c.moduri</td>
      <td class="left">application/cbor</td>
    </tr>
    <tr>
      <td class="left">Events</td>
      <td class="left">/c/s</td>
      <td class="left">core.c.stream</td>
      <td class="left">application/cbor</td>
    </tr>
  </tbody>
</table>
<h1 id="rfc.section.5"><a href="#rfc.section.5">5.</a> <a href="#mgFS" id="mgFS">/c Function Set</a></h1>
<p id="rfc.section.5.p.1">The /c Function Set provides a CoAP interface to manage YANG servers.</p>
<p id="rfc.section.5.p.2">The methods used by CoMI are:</p>
<table cellpadding="3" cellspacing="0" class="tt full center">
  <thead>
    <tr>
      <th class="left">Operation</th>
      <th class="left">Description</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td class="left">GET</td>
      <td class="left">Retrieve the datastore resource or a data resource</td>
    </tr>
    <tr>
      <td class="left">FETCH</td>
      <td class="left">Retrieve (partial) data resource(s)</td>
    </tr>
    <tr>
      <td class="left">POST</td>
      <td class="left">Create a data resource, invoke RPC</td>
    </tr>
    <tr>
      <td class="left">PUT</td>
      <td class="left">Create or replace a data resource</td>
    </tr>
    <tr>
      <td class="left">iPATCH</td>
      <td class="left">Idem-potently create, replace, and delete data resource(s) (partially)</td>
    </tr>
    <tr>
      <td class="left">DELETE</td>
      <td class="left">Delete a data resource</td>
    </tr>
  </tbody>
</table>
<p id="rfc.section.5.p.3">There is one query parameters for the GET, PUT, POST, and DELETE methods.</p>
<table cellpadding="3" cellspacing="0" class="tt full center">
  <thead>
    <tr>
      <th class="left">Query Parameter</th>
      <th class="left">Description</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td class="left">k</td>
      <td class="left">Select an instance of a list node</td>
    </tr>
  </tbody>
</table>
<p id="rfc.section.5.p.4">This parameter is not used for FETCH and iPATCH, because their request payloads support list instance selection.</p>
<h1 id="rfc.section.5.1"><a href="#rfc.section.5.1">5.1.</a> <a href="#query" id="query">Using the &#8216;k&#8217; query parameter</a></h1>
<p id="rfc.section.5.1.p.1">The &#8220;k&#8221; (key) parameter specifies the instance of a list node.  The SID in the URI is followed by the (?k=key1, key2,..). Where SID identifies a list node, and key1, key2 are the values of the key leaves that specify an instance of the list.</p>
<p id="rfc.section.5.1.p.2">Key values are encoded using the rules defined in the following table:</p>
<table cellpadding="3" cellspacing="0" class="tt full center">
  <thead>
    <tr>
      <th class="left">YANG datatype</th>
      <th class="left">Binary representation</th>
      <th class="left">Text representation</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td class="left">uint8,uint16,unit32, uint64</td>
      <td class="left">CBOR unsigned integer</td>
      <td class="left">int_to_text(number)</td>
    </tr>
    <tr>
      <td class="left">int8, int16,int32, int64</td>
      <td class="left">CBOR negative integer</td>
      <td class="left">base64 (CBOR representation)</td>
    </tr>
    <tr>
      <td class="left">decimal64</td>
      <td class="left">CBOR decimal fractions</td>
      <td class="left">base64  (CBOR representation</td>
    </tr>
    <tr>
      <td class="left">string</td>
      <td class="left">CBOR text or string</td>
      <td class="left">text</td>
    </tr>
    <tr>
      <td class="left">boolean</td>
      <td class="left">CBOR false or true</td>
      <td class="left">&#8220;0&#8221; or &#8220;1&#8221;</td>
    </tr>
    <tr>
      <td class="left">enumeration</td>
      <td class="left">CBOR unsigned integer</td>
      <td class="left">int_to_text (number)</td>
    </tr>
    <tr>
      <td class="left">bits</td>
      <td class="left">CBOR byte string</td>
      <td class="left">base64 (CBOR representation)</td>
    </tr>
    <tr>
      <td class="left">binary</td>
      <td class="left">CBOR byte string</td>
      <td class="left">base64 (binary value)</td>
    </tr>
    <tr>
      <td class="left">identityref</td>
      <td class="left">CBOR unsigned integer</td>
      <td class="left">int_to_text (number)</td>
    </tr>
    <tr>
      <td class="left">union</td>
      <td class="left"/>
      <td class="left">base64 (CBOR representation)</td>
    </tr>
    <tr>
      <td class="left">List instance identifier</td>
      <td class="left">CBOR unsigned integer</td>
      <td class="left">base64 (CBOR representation)</td>
    </tr>
    <tr>
      <td class="left">List instance identifier</td>
      <td class="left">CBOR array</td>
      <td class="left">Base64 (CBOR representation)</td>
    </tr>
  </tbody>
</table>
<h1 id="rfc.section.5.2"><a href="#rfc.section.5.2">5.2.</a> <a href="#DataRetrieval" id="DataRetrieval">Data Retrieval</a></h1>
<p id="rfc.section.5.2.p.1">One or more data node instances can be retrieved by the client.  The operation is mapped to the GET method defined in section 5.8.1 of <a href="#RFC7252">[RFC7252]</a> and to the FETCH method defined in section 2 of <a href="#I-D.ietf-core-etch">[I-D.ietf-core-etch]</a>.</p>
<p id="rfc.section.5.2.p.2">It is possible that the size of the payload is too large to fit in a single message.  In the case that management data is bigger than the maximum supported payload size, the Block mechanism from <a href="#RFC7959">[RFC7959]</a> is used, as explained in more detail in <a href="#block">Section 7</a>.</p>
<p id="rfc.section.5.2.p.3">CoMI uses the FETCH payload for retrieving a subset of the datastore.</p>
<p id="rfc.section.5.2.p.4">There are two additional query parameters for the GET and FETCH methods.</p>
<table cellpadding="3" cellspacing="0" class="tt full center">
  <thead>
    <tr>
      <th class="left">Query Parameter</th>
      <th class="left">Description</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td class="left">c</td>
      <td class="left">Control selection of configuration and non-configuration data nodes (GET and FETCH)</td>
    </tr>
    <tr>
      <td class="left">d</td>
      <td class="left">Control retrieval of default values.</td>
    </tr>
  </tbody>
</table>
<h1 id="rfc.section.5.2.1"><a href="#rfc.section.5.2.1">5.2.1.</a> <a href="#content" id="content">Using the &#8216;c&#8217; query parameter</a></h1>
<p id="rfc.section.5.2.1.p.1">The &#8216;c&#8217; (content) parameter controls how descendant nodes of the requested data nodes will be processed in the reply.</p>
<p id="rfc.section.5.2.1.p.2">The allowed values are:</p>
<table cellpadding="3" cellspacing="0" class="tt full center">
  <thead>
    <tr>
      <th class="left">Value</th>
      <th class="left">Description</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td class="left">c</td>
      <td class="left">Return only configuration descendant data nodes</td>
    </tr>
    <tr>
      <td class="left">n</td>
      <td class="left">Return only non-configuration descendant data nodes</td>
    </tr>
    <tr>
      <td class="left">a</td>
      <td class="left">Return all descendant data nodes</td>
    </tr>
  </tbody>
</table>
<p id="rfc.section.5.2.1.p.3">This parameter is only allowed for GET and FETCH methods on datastore and data resources.  A 4.00 Bad Request error is returned if used for other methods or resource types.</p>
<p id="rfc.section.5.2.1.p.4">If this query parameter is not present, the default value is &#8220;a&#8221;.</p>
<h1 id="rfc.section.5.2.2"><a href="#rfc.section.5.2.2">5.2.2.</a> <a href="#dquery" id="dquery">Using the &#8216;d&#8217; query parameter</a></h1>
<p id="rfc.section.5.2.2.p.1">The &#8220;d&#8221; (with-defaults) parameter controls how the default values of the descendant nodes of the requested data nodes will be processed.</p>
<p id="rfc.section.5.2.2.p.2">The allowed values are:</p>
<table cellpadding="3" cellspacing="0" class="tt full center">
  <thead>
    <tr>
      <th class="left">Value</th>
      <th class="left">Description</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td class="left">a</td>
      <td class="left">All data nodes are reported| Defined as &#8216;report-all&#8217; in section 3.1 of <a href="#RFC6243">[RFC6243]</a>.</td>
    </tr>
    <tr>
      <td class="left">t</td>
      <td class="left">Data nodes set to the YANG default are not reported.  Defined as &#8216;trim&#8217; in section 3.2 of <a href="#RFC6243">[RFC6243]</a>.</td>
    </tr>
  </tbody>
</table>
<p id="rfc.section.5.2.2.p.3">If the target of a GET or FETCH method is a data node that represents a leaf that has a default value, and the leaf has not been given a value yet, the server MUST return the leaf.</p>
<p id="rfc.section.5.2.2.p.4">If the target of a GET method is a data node that represents a container or list that has any child resources with default values, for the child resources that have not been given value yet, the server MUST not return the child resource if this query parameter is set to &#8216;t&#8217; and MUST return the child resource if this query parameter is set to &#8216;a&#8217;.</p>
<p id="rfc.section.5.2.2.p.5">If this query parameter is not present, the default value is &#8216;t&#8217;.</p>
<h1 id="rfc.section.5.2.3"><a href="#rfc.section.5.2.3">5.2.3.</a> <a href="#GetOperation" id="GetOperation">GET</a></h1>
<p id="rfc.section.5.2.3.p.1">A request to read the values of a data node instance is sent with a confirmable CoAP GET message. A single instance identifier is specified in the URI path prefixed with /c.</p>
<pre>
FORMAT:
    GET /c/&lt;instance identifier&gt;

    2.05 Content (Content-Format: application/cbor)
    &lt;data node value&gt;
</pre>
<p id="rfc.section.5.2.3.p.2">The returned payload is composed of all the children associated with the specified data node instance.</p>
<p id="rfc.section.5.2.3.p.3">The instance identifier is a SID or a SID followed by the &#8220;k&#8221; query parameter.</p>
<h1 id="rfc.section.5.2.3.1"><a href="#rfc.section.5.2.3.1">5.2.3.1.</a> <a href="#GetExamples" id="GetExamples">GET Examples</a></h1>
<p id="rfc.section.5.2.3.1.p.1">Using for example the current-datetime leaf from <a href="#ietf-system">Appendix A.1</a>, a request is sent to retrieve the value of system-state/clock/current-datetime specified in container system-state. The ID of system-state/clock/current-datetime is 1719, encoded in base64 this yields a3. The answer to the request returns a &lt;value&gt;, transported as a single CBOR string item.</p>
<pre>
REQ: GET example.com/c/a3

RES: 2.05 Content (Content-Format: application/cbor)
"2014-10-26T12:16:31Z"
</pre>
<p id="rfc.section.5.2.3.1.p.2">For example, the GET of the clock node (ID = 1717; base64: a1), sent by the client, results in the following returned value sent by the server, transported as a CBOR map containing 2 pairs:</p>
<pre>
REQ: GET example.com/c/a1

RES: 2.05 Content (Content-Format: application/cbor)
{
      +2 : "2014-10-26T12:16:51Z",   / ID 1719 /
      +1 : "2014-10-21T03:00:00Z"    / ID 1718 /
}
</pre>
<p id="rfc.section.5.2.3.1.p.3">A &#8220;list&#8221; node can have multiple instances. Accordingly, the returned payload of GET is composed of all the instances associated with the selected list node.</p>
<p id="rfc.section.5.2.3.1.p.4">For example, look at the example in <a href="#interfaces">Appendix A.3</a>. The GET of the /interfaces/interface/ (with identifier 1533, base64: X9) results in the following returned payload, transported as a CBOR array with 2 elements.</p>
<pre>
REQ: GET example.com/c/X9

RES: 2.05 Content (Content-Format: application/cbor)
[
 {+4 : "eth0",                / name  (ID 1537) /
  +1 : "Ethernet adaptor",    / description (ID 1534) /
  +5 : 1179,                  / type, (ID 1538) identity /
                              / ethernetCsmacd (ID 1179) /
  +2 : true                   / enabled ( ID 1535) /
 },
 {+4 : "eth1",                / name (ID 1537) /
  +1 : "Ethernet adaptor",    / description (ID 1534) /
  +5 : 1179,                  / type, (ID 1538) identity /
                              / ethernetCsmacd (ID 1179) /
  +2 : false                  / enabled /
  }
]
</pre>
<p id="rfc.section.5.2.3.1.p.5">It is equally possible to select a leaf of one instance of a list or a complete instance container with GET. The instance identifier is the numeric identifier of the list followed by the specification of the values for the key leaves that uniquely identify the list instance. The instance identifier looks like: SID?k=key-value. The key of &#8220;interface&#8221; is the &#8220;name&#8221; leaf. The example below requests the description leaf of the instance with name=&#8221;eth0&#8221; (ID=1534, base64: X-). The value of the description leaf is returned.</p>
<pre>
REQ: GET example.com/c/X-?k="eth0"

RES: 2.05 Content (Content-Format: application/cbor)
"Ethernet adaptor"
</pre>
<h1 id="rfc.section.5.2.4"><a href="#rfc.section.5.2.4">5.2.4.</a> <a href="#FETCH" id="FETCH">FETCH</a></h1>
<p id="rfc.section.5.2.4.p.1">The FETCH is used to retrieve a list of data node values. The FETCH Request payload contains a CBOR list of instance identifiers.</p>
<pre>
FORMAT:
    FETCH /c/ Content-Format (application/YANG-fetch+cbor)
    &lt;CBOR array of instance identifiers&gt;

    2.05 Content (Content-Format: application/YANG-patch+cbor)
    &lt;CBOR array of data node values&gt;
</pre>
<p id="rfc.section.5.2.4.p.2">The instance identifier is a SID or a CBOR array containing the SID followed by key values that identify the list instance (sec 5.13.1 of <a href="#I-D.ietf-core-yang-cbor">[I-D.ietf-core-yang-cbor]</a>. In the payload of the returned data node values, delta encoding is used as described in <a href="#I-D.ietf-core-yang-cbor">[I-D.ietf-core-yang-cbor]</a>.</p>
<h1 id="rfc.section.5.2.4.1"><a href="#rfc.section.5.2.4.1">5.2.4.1.</a> <a href="#FETCHEX" id="FETCHEX">FETCH examples</a></h1>
<p id="rfc.section.5.2.4.1.p.1">The example uses the current-datetime leaf and the interface list from <a href="#ietf-system">Appendix A.1</a>.  In the following example the value of current-datetime (ID 1719)and the interface list (ID 1533) instance identified with name=&#8221;eth0&#8221; are queried.</p>
<pre>
REQ:  FETCH /c Content-Format (application/YANG-fetch+cbor)
      [ 1719,            / ID 1719 /
      [-186, "eth0"]   / ID 1533 with name = "eth0" /
      ]

RES:  2.05 Content Content-Format (application/YANG-patch+cbor)
[
  "2014-10-26T12:16:31Z",
 {
   +4 : "eth0",                / name (ID 1537) /
   +1 : "Ethernet adaptor",    / description (ID 1534) /
   +5 : 1179,                  / type (ID 1538), identity /
                               / ethernetCsmacd (ID 1179) /
   +2 : true                   / enabled (ID 1535) /
  }
]
</pre>
<p id="rfc.section.5.2.4.1.p.2">TODO: align with future FETCH content format.</p>
<h1 id="rfc.section.5.3"><a href="#rfc.section.5.3">5.3.</a> <a href="#DataEditing" id="DataEditing">Data Editing</a></h1>
<p id="rfc.section.5.3.p.1">CoMI allows datastore contents to be created, modified and deleted using CoAP methods.</p>
<h1 id="rfc.section.5.3.1"><a href="#rfc.section.5.3.1">5.3.1.</a> <a href="#DataOrdering" id="DataOrdering">Data Ordering</a></h1>
<p id="rfc.section.5.3.1.p.1">A CoMI server SHOULD preserve the relative order of all user-ordered list and leaf-list entries that are received in a single edit request.  These YANG data node types are encoded as arrays so messages will preserve their order.</p>
<h1 id="rfc.section.5.3.2"><a href="#rfc.section.5.3.2">5.3.2.</a> <a href="#PostOperation" id="PostOperation">POST</a></h1>
<p id="rfc.section.5.3.2.p.1">Data resources are created with the POST method.  The CoAP POST operation is used in CoMI for creation of data resources and the invocation of &#8220;ACTION&#8221; and &#8220;RPC&#8221; resources.  Refer to <a href="#RPC">Section 5.6</a> for details on &#8220;ACTION&#8221; and &#8220;RPC&#8221; resources.</p>
<p id="rfc.section.5.3.2.p.2">A request to create the values of an instance of a container or leaf is sent with a confirmable CoAP POST message. A single SID is specified in the URI path prefixed with /c.</p>
<pre>
FORMAT:
    POST /c/&lt;instance identifier&gt; Content-Format(application/cbor)
    &lt;data node value&gt;

    2.01 Created (Content-Format: application/cbor)
</pre>
<p id="rfc.section.5.3.2.p.3">If the data resource already exists, then the POST request MUST fail and a &#8220;4.09 Conflict&#8221; status-line MUST be returned</p>
<p id="rfc.section.5.3.2.p.4">The instance identifier is a SID or a SID followed by the &#8220;k&#8221; query parameter.</p>
<h1 id="rfc.section.5.3.2.1"><a href="#rfc.section.5.3.2.1">5.3.2.1.</a> <a href="#POSTEX" id="POSTEX">Post example</a></h1>
<p id="rfc.section.5.3.2.1.p.1">The example uses the interface list from <a href="#ietf-system">Appendix A.1</a>.  Example is creating a new version of the container interface (ID = 1533):</p>
<pre>
REQ: POST /c/X9 Content-Format(application/cbor)
      {
        +4 : "eth0",             / name (ID 1537) /
        +1 : "Ethernet adaptor", / description (ID 1534) /
        +5 : 1179,               / type (ID 1538), identity /
                                 / ethernetCsmacd (ID 1179) /
        +2 : true                / enabled (ID 1535) /
      }

RES: 2.01 Created (Content-Format: application/cbor)
</pre>
<h1 id="rfc.section.5.3.3"><a href="#rfc.section.5.3.3">5.3.3.</a> <a href="#PutOperation" id="PutOperation">PUT</a></h1>
<p id="rfc.section.5.3.3.p.1">Data resource instances are created or replaced with the PUT method.  The PUT operation is supported in CoMI.  A request to set the value of a data node instance is sent with a confirmable CoAP PUT message.</p>
<pre>
FORMAT:
    PUT /c/&lt;instance identifier&gt; Content-Format(application/cbor)
    &lt;data node value&gt;

    2.01 Created
</pre>
<p id="rfc.section.5.3.3.p.2">The instance identifier is a SID or a SID followed by the &#8220;k&#8221; query parameter.</p>
<h1 id="rfc.section.5.3.3.1"><a href="#rfc.section.5.3.3.1">5.3.3.1.</a> <a href="#PUTEX" id="PUTEX">PUT example</a></h1>
<p id="rfc.section.5.3.3.1.p.1">The example uses the interface list from <a href="#ietf-system">Appendix A.1</a>.  Example is renewing an instance of the list interface (ID = 1533) with key name=&#8221;eth0&#8221;:</p>
<pre>
REQ:  PUT /c/X9?k="eth0" Content-Format(application/cbor)
      {
        +4 : "eth0",             / name (ID 1537) /
        +1 : "Ethernet adaptor", / description (ID 1534) /
        +5 : 1179,               / type (ID 1538), identity /
                                 / ethernetCsmacd ( ID 1179) /
        +2 : true                / enabled (ID 1535) /
      }
RES:  2.04 Changed
</pre>
<h1 id="rfc.section.5.3.4"><a href="#rfc.section.5.3.4">5.3.4.</a> <a href="#PatchOperation" id="PatchOperation">iPATCH</a></h1>
<p id="rfc.section.5.3.4.p.1">One or multiple data resource instances are replaced with the idem-potent iPATCH method <a href="#I-D.ietf-core-etch">[I-D.ietf-core-etch]</a>.  A request is sent with a confirmable CoAP iPATCH message.</p>
<p id="rfc.section.5.3.4.p.2">There are no query parameters for the iPATCH method.</p>
<p id="rfc.section.5.3.4.p.3">The processing of the iPATCH command is specified by the CBOR payload. The CBOR patch payload describes the changes to be made to target YANG data nodes <a href="#I-D.bormann-appsawg-cbor-merge-patch">[I-D.bormann-appsawg-cbor-merge-patch]</a>. If the CBOR patch payload contains data node instances that are not present in the target, these instances are added or silently ignored dependent of the payload information. If the target contains the specified instance, the contents of the instances are replaced with the values of the payload. Null values indicate the removal of existing values.</p>
<pre>
FORMAT:
    iPATCH /c Content-Format(application/YANG-patch+cbor)
    &lt;set of data node instances&gt;

    2.04 Changed
</pre>
<h1 id="rfc.section.5.3.4.1"><a href="#rfc.section.5.3.4.1">5.3.4.1.</a> <a href="#IPATCHEX" id="IPATCHEX">iPATCH example</a></h1>
<p id="rfc.section.5.3.4.1.p.1">The example uses the interface list from <a href="#interfaces">Appendix A.3</a>, and the timezone-utc-offset leaf from <a href="#ietf-system">Appendix A.1</a>.  In the example one leaf (timezone-utc-offset ) and one container (interface) instance are changed.</p>
<pre>
REQ: iPATCH /c Content-Format(application/YANG-patch+cbor)
[
  [1533, "eth0"] ,                / interface (ID = 1533) /
    {
      +4 : "eth0",                / name (ID 1537) /
      +1 : "Ethernet adaptor",    / description (ID 1534) /
      +5 : 1179,                  / type (ID 1538), identity /
                                  / ethernetCsmacd (ID 1179) /
      +2 : true                   / enabled (ID 1535) /
    },
  +203 , 60          / timezone-utc-offset (delta = 1736-1533) /
]

RES: 2.04 Changed
</pre>
<p id="rfc.section.5.3.4.1.p.2">TODO: Align with future cbor-merge-patch content format.</p>
<h1 id="rfc.section.5.3.5"><a href="#rfc.section.5.3.5">5.3.5.</a> <a href="#DeleteOperation" id="DeleteOperation">DELETE</a></h1>
<p id="rfc.section.5.3.5.p.1">Data resource instances are deleted with the DELETE method.  The RESTCONF DELETE operation is supported in CoMI.</p>
<pre>
FORMAT:
    Delete /c/&lt;instance identifier&gt;

    2.02 Deleted
</pre>
<p id="rfc.section.5.3.5.p.2">The instance identifier is a SID or a SID followed by the &#8220;k&#8221; query parameter.</p>
<h1 id="rfc.section.5.3.5.1"><a href="#rfc.section.5.3.5.1">5.3.5.1.</a> <a href="#DELETEX" id="DELETEX">DELETE example</a></h1>
<p id="rfc.section.5.3.5.1.p.1">The example uses the interface list from <a href="#interfaces">Appendix A.3</a>.  Example is deleting an instance of the container interface (ID = 1533):</p>
<pre>
REQ:   DELETE /c/X9?k="eth0"

RES:   2.02 Deleted
</pre>
<h1 id="rfc.section.5.4"><a href="#rfc.section.5.4">5.4.</a> <a href="#DATASTORE" id="DATASTORE">Full Data Store access</a></h1>
<p id="rfc.section.5.4.p.1">The methods GET, PUT, POST, and DELETE can be used to return, replace, create, and delete the whole data store respectively.</p>
<pre>
FORMAT:
    GET /c
    2.05 Content (Content-Format: application/cbor)
    &lt;array of data node instances&gt;

   PUT /c
   (Content-Format: application/cbor)
    &lt;array of data node instances&gt;
   2.04 Changed

   POST /c
   (Content-Format: application/cbor)
    &lt;array of data node instances&gt;
   2.01 Created

   DELETE /c
   2.02 Deleted

</pre>
<p id="rfc.section.5.4.p.2">The array of data node instances represents an array of all root nodes in the data store after the PUT, POST and GET method invocations.</p>
<h1 id="rfc.section.5.4.1"><a href="#rfc.section.5.4.1">5.4.1.</a> <a href="#FULLDATEX" id="FULLDATEX">Full Data Store examples</a></h1>
<p id="rfc.section.5.4.1.p.1">The example uses the interface list and the clock container from <a href="#interfaces">Appendix A.3</a>.  Assume that the data store contains two root objects: the list interface (ID 1533) with one instance and the container Clock (ID 1717). After invocation of GET an array with these two objects is returned:</p>
<pre>
RQ:  GET /c
RES: 2.05 Content Content-Format (application/YANG-patch+cbor)
[
  {1717:
     { +2: "2016-10-26T12:16:31Z", / current-datetime (ID 1719) /
       +1: "2014-10-05T09:00:00Z"  / boot-datetime (ID 1718) /
     },
  -186:                            / clock (ID 1533) /
     {
       +4 : "eth0",                / name (ID 1537) /
       +1 : "Ethernet adaptor",    / description (ID 1534) /
       +5 : 1179,                  / type (ID 1538), identity: /
                                   / ethernetCsmacd (ID 1179) /
       +2 : true                   / enabled (ID 1535) /
      }
    }
]
</pre>
<h1 id="rfc.section.5.5"><a href="#rfc.section.5.5">5.5.</a> <a href="#Notify" id="Notify">Notify functions</a></h1>
<p id="rfc.section.5.5.p.1">Notification by the server to a selection of clients when an event occurs in the server is an essential function for the management of servers. CoMI allows events specified in YANG <a href="#RFC5277">[RFC5277]</a> to be notified to a selection of requesting clients. The server appends newly generated events to a stream. There is one, so-called &#8220;default&#8221;, stream in a CoMI server. The /c/s resource identifies the default stream. The server MAY create additional stream resources. When a CoMI server generates an internal event, it is appended to the chosen stream, and the content of a notification instance is ready to be sent to all CoMI clients which observe the chosen stream resource.</p>
<p id="rfc.section.5.5.p.2">Reception of generated notification instances is enabled with the CoAP Observe <a href="#RFC7641">[RFC7641]</a> function.  The client subscribes to the notifications by sending a GET request with an &#8220;Observe&#8221; option, specifying the /c/s resource when the default stream is selected.</p>
<p id="rfc.section.5.5.p.3">Every time an event is generated, the chosen stream is cleared, and the generated notification instance is appended to the chosen stream(s). After appending the instance, the contents of the instance is sent to all clients observing the modified stream.</p>
<pre>
FORMAT:
  Get /&lt;stream-resource&gt;
      Content-Format(application/YANG-patch+cbor) Observe(0)

2.05 Content Content-Format(application/YANG-patch+cbor)
&lt;set of data node instances&gt;

</pre>
<h1 id="rfc.section.5.5.1"><a href="#rfc.section.5.5.1">5.5.1.</a> <a href="#NotifyEX" id="NotifyEX">Notify Examples</a></h1>
<p id="rfc.section.5.5.1.p.1">Suppose the server generates the event specified in <a href="#notify-ex">Appendix A.4</a>. By executing a GET on the /c/s resource the client receives the following response:</p>
<pre>
REQ:  GET /c/s Observe(0) Token(0x93)

RES:  2.05 Content Content-Format(application/YANG-patch+cbor)
                        Observe(12) Token(0x93)
{
   60010 :                  / example-port-fault (ID 60010) /
    {
      +1 : "0/4/21",       / port-name (ID 60011) /
      +2 : "Open pin 2"    / port-fault (ID 60012) /
    },
   60010 :                  / example-port-fault (ID 60010) /
    {
      +1 : "1/4/21",       / port-name (ID 60011) /
      +2 : "Open pin 5"    / port-fault (ID 60012) /
    }
}

</pre>
<p id="rfc.section.5.5.1.p.2">In the example, the request returns a success response with the contents of the last two generated events. Consecutively the server will regularly notify the client when a new event is generated.</p>
<p id="rfc.section.5.5.1.p.3">To check that the client is still alive, the server MUST send confirmable notifications once in a while. When the client does not confirm the notification from the server, the server will remove the client from the list of observers <a href="#RFC7641">[RFC7641]</a>.</p>
<h1 id="rfc.section.5.6"><a href="#rfc.section.5.6">5.6.</a> <a href="#RPC" id="RPC">RPC statements</a></h1>
<p id="rfc.section.5.6.p.1">The YANG &#8220;action&#8221; and &#8220;RPC&#8221; statements specify the execution of a Remote procedure Call (RPC) in the server.  It is invoked using a POST method to an &#8220;Action&#8221; or &#8220;RPC&#8221; resource instance. The Request payload contains the values assigned to the input container when specified with the action station.  The Response payload contains the values of the output container when specified.</p>
<p id="rfc.section.5.6.p.2">The returned success response code is 2.05 Content.</p>
<pre>
FORMAT:
 POST /c/&lt;instance identifier&gt;
           Content-Format(application/YANG-patch+cbor)
&lt;input node value&gt;

2.05 Content Content-Format (application/YANG-patch+cbor)
&lt;output node value&gt;

</pre>
<p id="rfc.section.5.6.p.3">There &#8220;k&#8221; query parameter is allowed for the POST method when used for an action invocation.</p>
<h1 id="rfc.section.5.6.1"><a href="#rfc.section.5.6.1">5.6.1.</a> <a href="#RPCEX" id="RPCEX">RPC Example</a></h1>
<p id="rfc.section.5.6.1.p.1">The example is based on the YANG action specification of <a href="#server">Appendix A.2</a>. A server list is specified and the action &#8220;reset&#8221; (ID 60002, base64: Opq), that is part of a &#8220;server instance&#8221; with key value &#8220;myserver&#8221;, is invoked.</p>
<pre>
REQ:  POST /c/Opq?k="myserver"
              Content-Format(application/YANG-patch+cbor)
{
  +1 : "2016-02-08T14:10:08Z09:00" / reset-at (ID 60003) /
}

RES:  2.05 Content Content-Format(application/YANG-patch+cbor)
{
  +2 : "2016-02-08T14:10:08Z09:18" / reset-finished-at (ID 60004)/
}
</pre>
<h1 id="rfc.section.6"><a href="#rfc.section.6">6.</a> <a href="#MIB" id="MIB">Access to MIB Data</a></h1>
<p><a href="#SMI">Appendix A.5</a> shows a YANG module mapped from the SMI specification &#8220;IP-MIB&#8221; <a href="#RFC4293">[RFC4293]</a>.  The following example shows the &#8220;ipNetToPhysicalEntry&#8221; list with 2 instances, using diagnostic notation without delta encoding.</p>
<pre>
{
   60021 :                     / list ipNetToPhysicalEntry /
   [
     {
       60022 : 1,              / ipNetToPhysicalIfIndex /
       60023 : 1,              / ipNetToPhysicalNetAddressType: ipv4 /
       60024 : h'0A000033',    / ipNetToPhysicalNetAddress /
       60025 : h'00000A01172D',/ ipNetToPhysicalPhysAddress /
       60026 : 2333943,        / ipNetToPhysicalLastUpdated /
       60027 : 4,              / ipNetToPhysicalType: static /
       60028 : 1,              / ipNetToPhysicalState: reachable /
       60029 : 1               / ipNetToPhysicalRowStatus: active /
     },
     {
       60022 : 1,              / ipNetToPhysicalIfIndex /
       60023 : 1,              / ipNetToPhysicalNetAddressType: ipv4 /
       60024 : h'09020304',    / ipNetToPhysicalNetAddress  /
       60025 : h'00000A36200A',/ ipNetToPhysicalPhysAddress /
       60026 : 2329836,        / ipNetToPhysicalLastUpdated /
       60027 : 3,              / ipNetToPhysicalType: dynamic /
       60028 : 6,              / ipNetToPhysicalState: unknown /
       60029 : 1               / ipNetToPhysicalRowStatus: active /
     }
   ]
}
</pre>
<p id="rfc.section.6.p.2">The IPv4 addresses A.0.0.33 and 9.2.3.4 are encoded in CBOR as h&#8217;0A000033&#8217; and h&#8217;09020304&#8217; respectively.  In the following example exactly one instance is requested from the ipNetToPhysicalEntry (ID 60021, base64: Oz1). The h&#8217;09020304&#8217; value is encoded in base64 as AJAgME.</p>
<p id="rfc.section.6.p.3">In this example one instance of /ip/ipNetToPhysicalEntry that matches the keys ipNetToPhysicalIfIndex = 1, ipNetToPhysicalNetAddressType = ipv4 and ipNetToPhysicalNetAddress = 9.2.3.4 (h&#8217;09020304&#8217;, base64: AJAgME).</p>
<pre>
REQ: GET example.com/c/Oz1?k="1,1,AJAgME"

RES: 2.05 Content (Content-Format: application/YANG-patch+cbor)
{
   +1 : 1,                  / ( SID 60022 ) /
   +2 : 1,                  / ( SID 60023 ) /
   +3 : h'09020304',        / ( SID 60024 ) /
   +4 : h'00000A36200A',    / ( SID 60025 ) /
   +5 : 2329836,            / ( SID 60026 ) /
   +6 : 3,                  / ( SID 60027 ) /
   +7 : 6,                  / ( SID 60028 ) /
   +8 : 1                   / ( SID 60029 ) /
}
</pre>
<h1 id="rfc.section.7"><a href="#rfc.section.7">7.</a> <a href="#block" id="block">Use of Block</a></h1>
<p id="rfc.section.7.p.1">The CoAP protocol provides reliability by acknowledging the UDP datagrams.  However, when large pieces of text need to be transported the datagrams get fragmented, thus creating constraints on the resources in the client, server and intermediate routers. The block option <a href="#RFC7959">[RFC7959]</a> allows the transport of the total payload in individual blocks of which the size can be adapted to the underlying transport sizes such as: (UDP datagram size ~64KiB, IPv6 MTU of 1280, IEEE 802.15.4 payload of 60-80 bytes). Each block is individually acknowledged to guarantee reliability.</p>
<p id="rfc.section.7.p.2">Notice that the Block mechanism splits the data at fixed positions, such that individual data fields may become fragmented.  Therefore,  assembly of multiple blocks may be required to process the complete data field.</p>
<p id="rfc.section.7.p.3">Beware of race conditions. Blocks are filled one at a time and care should be taken that the whole data representation is sent in multiple blocks sequentially without interruption. In the server, values are changed, lists are re-ordered, extended or reduced. When these actions happen during the serialization of the contents of the variables, the transported results do not correspond with a state having occurred in the server; or worse the returned values are inconsistent. For example: array length does not correspond with actual number of items. It may be advisable to use CBOR maps or CBOR arrays of undefined length which are foreseen for data streaming purposes.</p>
<h1 id="rfc.section.8"><a href="#rfc.section.8">8.</a> <a href="#discovery" id="discovery">Resource Discovery</a></h1>
<p id="rfc.section.8.p.1">The presence and location of (path to) the management data are discovered by sending a GET request to &#8220;/.well-known/core&#8221; including a resource type (RT) parameter with the value &#8220;core.c&#8221; <a href="#RFC6690">[RFC6690]</a>. Upon success, the return payload will contain the root resource of the management data. It is up to the implementation to choose its root resource, but it is recommended that the value &#8220;/c&#8221; is used, where possible. The example below shows the discovery of the presence and location of management data.</p>
<pre>
  REQ: GET /.well-known/core?rt=core.c

  RES: 2.05 Content &lt;/c&gt;; rt="core.c"

</pre>
<p id="rfc.section.8.p.2">Management objects MAY be discovered with the standard CoAP resource discovery.  The implementation can add the encoded values of the object identifiers to /.well-known/core with rt=&#8221;core.c.data&#8221;. The available objects identified by the encoded values can be discovered by sending a GET request to &#8220;/.well-known/core&#8221; including a resource type (RT) parameter with the value &#8220;core.c.data&#8221;. Upon success, the return payload will contain the registered encoded values and their location.  The example below shows the discovery of the presence and location of management data.</p>
<pre>
  REQ: GET /.well-known/core?rt=core.c.data

  RES: 2.05 Content &lt;/c/BaAiN&gt;; rt="core.c.data",
  &lt;/c/CF_fA&gt;; rt="core.c.data"

</pre>
<p id="rfc.section.8.p.3">Lists of encoded values may become prohibitively long. It is discouraged to provide long lists of objects on discovery. Therefore, it is recommended that details about management objects are discovered by reading the YANG module information stored in for example the &#8220;ietf-comi-yang-library&#8221; module <a href="#I-D.veillette-core-cool-library">[I-D.veillette-core-cool-library]</a>.  The resource &#8220;/c/mod.uri&#8221; is used to retrieve the location of the YANG module library.</p>
<p id="rfc.section.8.p.4">The module list can be stored locally on each server, or remotely on a different server. The latter is advised when the deployment of many servers are identical.</p>
<pre>
  Local in example.com server:

  REQ: GET example.com/c/mod.uri

  RES: 2.05 Content (Content-Format: application/cbor)
  {
    "mod.uri" : "example.com/c/modules"
  }


  Remote in example-remote-server:

  REQ: GET example.com/c/mod.uri

  RES: 2.05 Content (Content-Format: application/cbor)
  {
    "moduri" : "example-remote-server.com/c/group17/modules"
  }

</pre>
<p id="rfc.section.8.p.5">Within the YANG module library all information about the module is stored such as: module identifier, identifier hierarchy, grouping, features and revision numbers.</p>
<h1 id="rfc.section.9"><a href="#rfc.section.9">9.</a> <a href="#ERRORS" id="ERRORS">Error Handling</a></h1>
<p id="rfc.section.9.p.1">In case a request is received which cannot be processed properly, the CoMI server MUST return an error message.  This error message MUST contain a CoAP 4.xx or 5.xx response code, and SHOULD include additional information in the payload.</p>
<p id="rfc.section.9.p.2">Such an error message payload is a text string, using the following structure:</p>
<pre>
CoMI error: xxxx "error text"

</pre>
<p id="rfc.section.9.p.3">The characters xxxx represent one of the values from the table below, and the OPTIONAL &#8220;error text&#8221; field contains a human readable explanation of the error.</p>
<table cellpadding="3" cellspacing="0" class="tt full center">
  <thead>
    <tr>
      <th class="left">CoMI Error Code</th>
      <th class="left">CoAP Error Code</th>
      <th class="left">Description</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td class="left">0</td>
      <td class="left">4.xx</td>
      <td class="left">General error</td>
    </tr>
    <tr>
      <td class="left">1</td>
      <td class="left">4.13</td>
      <td class="left">Request too big</td>
    </tr>
    <tr>
      <td class="left">2</td>
      <td class="left">4.00</td>
      <td class="left">Response too big</td>
    </tr>
    <tr>
      <td class="left">3</td>
      <td class="left">4.00</td>
      <td class="left">Unknown identifier</td>
    </tr>
    <tr>
      <td class="left">4</td>
      <td class="left">4.00</td>
      <td class="left">Invalid value</td>
    </tr>
    <tr>
      <td class="left">5</td>
      <td class="left">4.05</td>
      <td class="left">Attempt to write read-only variable</td>
    </tr>
    <tr>
      <td class="left">6</td>
      <td class="left">5.01</td>
      <td class="left">No access</td>
    </tr>
    <tr>
      <td class="left">7</td>
      <td class="left">4.00</td>
      <td class="left">Wrong type</td>
    </tr>
    <tr>
      <td class="left">8</td>
      <td class="left">4.15</td>
      <td class="left">Unknown encoding</td>
    </tr>
    <tr>
      <td class="left">9</td>
      <td class="left">4.0</td>
      <td class="left">Wrong value</td>
    </tr>
    <tr>
      <td class="left">10</td>
      <td class="left">4.0</td>
      <td class="left">Not created</td>
    </tr>
    <tr>
      <td class="left">11</td>
      <td class="left">4.04</td>
      <td class="left">Resource unavailable</td>
    </tr>
    <tr>
      <td class="left">12</td>
      <td class="left">4.01</td>
      <td class="left">Authorization error</td>
    </tr>
    <tr>
      <td class="left">13</td>
      <td class="left">4.0</td>
      <td class="left">Bad attribute</td>
    </tr>
    <tr>
      <td class="left">14</td>
      <td class="left">4.0</td>
      <td class="left">Unknown attribute</td>
    </tr>
    <tr>
      <td class="left">15</td>
      <td class="left">4.0</td>
      <td class="left">Missing attribute</td>
    </tr>
  </tbody>
</table>
<p id="rfc.section.9.p.4">The CoMI error codes are motivated by the error-status values defined in <a href="#RFC3416">[RFC3416]</a>, and the error tags defined in <a href="#I-D.ietf-netconf-restconf">[I-D.ietf-netconf-restconf]</a>.</p>
<h1 id="rfc.section.10"><a href="#rfc.section.10">10.</a> <a href="#security-considerations" id="security-considerations">Security Considerations</a></h1>
<p id="rfc.section.10.p.1">For secure network management, it is important to restrict access to configuration variables only to authorized parties.  This requires integrity protection of both requests and responses, and depending on the application encryption.</p>
<p id="rfc.section.10.p.2">CoMI re-uses the security mechanisms already available to CoAP as much as possible.  This includes DTLS <a href="#RFC6347">[RFC6347]</a> for protected access to resources, as well suitable authentication and authorization mechanisms.</p>
<p id="rfc.section.10.p.3">Among the security decisions that need to be made are selecting security modes and encryption mechanisms (see <a href="#RFC7252">[RFC7252]</a>).  This requires a trade-off, as the NoKey mode gives no protection at all, but is easy to implement, whereas the X.509 mode is quite secure, but may be too complex for constrained devices.</p>
<p id="rfc.section.10.p.4">In addition, mechanisms for authentication and authorization may need to be selected.</p>
<p id="rfc.section.10.p.5">CoMI avoids defining new security mechanisms as much as possible.  However some adaptations may still be required, to cater for CoMI&#8217;s specific requirements.</p>
<h1 id="rfc.section.11"><a href="#rfc.section.11">11.</a> <a href="#iana-considerations" id="iana-considerations">IANA Considerations</a></h1>
<p id="rfc.section.11.p.1">&#8216;rt=&#8221;core.c&#8221;&#8217; needs registration with IANA.</p>
<p id="rfc.section.11.p.2">&#8216;rt=&#8221;core.c.data&#8221;&#8217; needs registration with IANA.</p>
<p id="rfc.section.11.p.3">&#8216;rt=&#8221;core.c.moduri&#8221;&#8217; needs registration with IANA.</p>
<p id="rfc.section.11.p.4">&#8216;rt=&#8221;core.c.stream&#8221;&#8217; needs registration with IANA.</p>
<p id="rfc.section.11.p.5">Content types to be registered:</p>
<p/>

<ul>
  <li>application/YANG-patch+cbor</li>
  <li>application/YANG-fetch+cbor</li>
</ul>
<h1 id="rfc.section.12"><a href="#rfc.section.12">12.</a> <a href="#acknowledgements" id="acknowledgements">Acknowledgements</a></h1>
<p id="rfc.section.12.p.1">We are very grateful to Bert Greevenbosch who was one of the original authors of the CoMI specification and specified CBOR encoding and use of hashes.</p>
<p id="rfc.section.12.p.2">Mehmet Ersue and Bert Wijnen explained the encoding aspects of PDUs transported under SNMP. Carsten Bormann has given feedback on the use of CBOR.</p>
<p id="rfc.section.12.p.3">Timothy Carey has provided the text for <a href="#LWM2M">Appendix B</a>.</p>
<p id="rfc.section.12.p.4">The draft has benefited from comments (alphabetical order) by Rodney Cummings, Dee Denteneer, Esko Dijk, Michael van Hartskamp, Juergen Schoenwaelder, Anuj Sehgal, Zach Shelby, Hannes Tschofenig, Michael Verschoor, and Thomas Watteyne.</p>
<h1 id="rfc.section.13"><a href="#rfc.section.13">13.</a> <a href="#changelog" id="changelog">Changelog</a></h1>
<p id="rfc.section.13.p.1">Copy of vanderstok-core-comi-11.</p>
<h1 id="rfc.references"><a href="#rfc.references">14.</a> References</h1>
<h1 id="rfc.references.1"><a href="#rfc.references.1">14.1.</a> Normative References</h1>
<table>
  <tbody>
    <tr>
      <td class="reference">
        <b id="RFC2119">[RFC2119]</b>
      </td>
      <td class="top"><a>Bradner, S.</a>, "<a href="http://tools.ietf.org/html/rfc2119">Key words for use in RFCs to Indicate Requirement Levels</a>", BCP 14, RFC 2119, DOI 10.17487/RFC2119, March 1997.</td>
    </tr>
    <tr>
      <td class="reference">
        <b id="RFC5277">[RFC5277]</b>
      </td>
      <td class="top"><a>Chisholm, S.</a> and <a>H. Trevino</a>, "<a href="http://tools.ietf.org/html/rfc5277">NETCONF Event Notifications</a>", RFC 5277, DOI 10.17487/RFC5277, July 2008.</td>
    </tr>
    <tr>
      <td class="reference">
        <b id="RFC6243">[RFC6243]</b>
      </td>
      <td class="top"><a>Bierman, A.</a> and <a>B. Lengyel</a>, "<a href="http://tools.ietf.org/html/rfc6243">With-defaults Capability for NETCONF</a>", RFC 6243, DOI 10.17487/RFC6243, June 2011.</td>
    </tr>
    <tr>
      <td class="reference">
        <b id="RFC7049">[RFC7049]</b>
      </td>
      <td class="top"><a>Bormann, C.</a> and <a>P. Hoffman</a>, "<a href="http://tools.ietf.org/html/rfc7049">Concise Binary Object Representation (CBOR)</a>", RFC 7049, DOI 10.17487/RFC7049, October 2013.</td>
    </tr>
    <tr>
      <td class="reference">
        <b id="RFC7252">[RFC7252]</b>
      </td>
      <td class="top"><a>Shelby, Z.</a>, <a>Hartke, K.</a> and <a>C. Bormann</a>, "<a href="http://tools.ietf.org/html/rfc7252">The Constrained Application Protocol (CoAP)</a>", RFC 7252, DOI 10.17487/RFC7252, June 2014.</td>
    </tr>
    <tr>
      <td class="reference">
        <b id="RFC7950">[RFC7950]</b>
      </td>
      <td class="top"><a>Bjorklund, M.</a>, "<a href="http://tools.ietf.org/html/rfc7950">The YANG 1.1 Data Modeling Language</a>", RFC 7950, DOI 10.17487/RFC7950, August 2016.</td>
    </tr>
    <tr>
      <td class="reference">
        <b id="RFC7959">[RFC7959]</b>
      </td>
      <td class="top"><a>Bormann, C.</a> and <a>Z. Shelby</a>, "<a href="http://tools.ietf.org/html/rfc7959">Block-Wise Transfers in the Constrained Application Protocol (CoAP)</a>", RFC 7959, DOI 10.17487/RFC7959, August 2016.</td>
    </tr>
    <tr>
      <td class="reference">
        <b id="RFC7641">[RFC7641]</b>
      </td>
      <td class="top"><a>Hartke, K.</a>, "<a href="http://tools.ietf.org/html/rfc7641">Observing Resources in the Constrained Application Protocol (CoAP)</a>", RFC 7641, DOI 10.17487/RFC7641, September 2015.</td>
    </tr>
    <tr>
      <td class="reference">
        <b id="I-D.ietf-netconf-restconf">[I-D.ietf-netconf-restconf]</b>
      </td>
      <td class="top"><a>Bierman, A.</a>, <a>Bjorklund, M.</a> and <a>K. Watsen</a>, "<a href="http://tools.ietf.org/html/draft-ietf-netconf-restconf-18">RESTCONF Protocol</a>", Internet-Draft draft-ietf-netconf-restconf-18, October 2016.</td>
    </tr>
    <tr>
      <td class="reference">
        <b id="I-D.ietf-core-etch">[I-D.ietf-core-etch]</b>
      </td>
      <td class="top"><a>Stok, P.</a>, <a>Bormann, C.</a> and <a>A. Sehgal</a>, "<a href="http://tools.ietf.org/html/draft-ietf-core-etch-04">Patch and Fetch Methods for Constrained Application Protocol (CoAP)</a>", Internet-Draft draft-ietf-core-etch-04, November 2016.</td>
    </tr>
    <tr>
      <td class="reference">
        <b id="I-D.bormann-appsawg-cbor-merge-patch">[I-D.bormann-appsawg-cbor-merge-patch]</b>
      </td>
      <td class="top"><a>Bormann, C.</a> and <a>P. Stok</a>, "<a href="http://tools.ietf.org/html/draft-bormann-appsawg-cbor-merge-patch-00">CBOR Merge Patch</a>", Internet-Draft draft-bormann-appsawg-cbor-merge-patch-00, March 2016.</td>
    </tr>
    <tr>
      <td class="reference">
        <b id="I-D.ietf-core-yang-cbor">[I-D.ietf-core-yang-cbor]</b>
      </td>
      <td class="top"><a>Veillette, M.</a>, <a>Pelov, A.</a>, <a>Somaraju, A.</a>, <a>Turner, R.</a> and <a>A. Minaburo</a>, "<a href="http://tools.ietf.org/html/draft-ietf-core-yang-cbor-03">CBOR Encoding of Data Modeled with YANG</a>", Internet-Draft draft-ietf-core-yang-cbor-03, October 2016.</td>
    </tr>
  </tbody>
</table>
<h1 id="rfc.references.2"><a href="#rfc.references.2">14.2.</a> Informative References</h1>
<table>
  <tbody>
    <tr>
      <td class="reference">
        <b id="RFC2578">[RFC2578]</b>
      </td>
      <td class="top"><a>McCloghrie, K.</a>, <a>Perkins, D.</a> and <a>J. Schoenwaelder</a>, "<a href="http://tools.ietf.org/html/rfc2578">Structure of Management Information Version 2 (SMIv2)</a>", STD 58, RFC 2578, DOI 10.17487/RFC2578, April 1999.</td>
    </tr>
    <tr>
      <td class="reference">
        <b id="RFC3410">[RFC3410]</b>
      </td>
      <td class="top"><a>Case, J.</a>, <a>Mundy, R.</a>, <a>Partain, D.</a> and <a>B. Stewart</a>, "<a href="http://tools.ietf.org/html/rfc3410">Introduction and Applicability Statements for Internet-Standard Management Framework</a>", RFC 3410, DOI 10.17487/RFC3410, December 2002.</td>
    </tr>
    <tr>
      <td class="reference">
        <b id="RFC3416">[RFC3416]</b>
      </td>
      <td class="top"><a>Presuhn, R.</a>, "<a href="http://tools.ietf.org/html/rfc3416">Version 2 of the Protocol Operations for the Simple Network Management Protocol (SNMP)</a>", STD 62, RFC 3416, DOI 10.17487/RFC3416, December 2002.</td>
    </tr>
    <tr>
      <td class="reference">
        <b id="RFC4293">[RFC4293]</b>
      </td>
      <td class="top"><a>Routhier, S.</a>, "<a href="http://tools.ietf.org/html/rfc4293">Management Information Base for the Internet Protocol (IP)</a>", RFC 4293, DOI 10.17487/RFC4293, April 2006.</td>
    </tr>
    <tr>
      <td class="reference">
        <b id="RFC6241">[RFC6241]</b>
      </td>
      <td class="top"><a>Enns, R.</a>, <a>Bjorklund, M.</a>, <a>Schoenwaelder, J.</a> and <a>A. Bierman</a>, "<a href="http://tools.ietf.org/html/rfc6241">Network Configuration Protocol (NETCONF)</a>", RFC 6241, DOI 10.17487/RFC6241, June 2011.</td>
    </tr>
    <tr>
      <td class="reference">
        <b id="RFC6347">[RFC6347]</b>
      </td>
      <td class="top"><a>Rescorla, E.</a> and <a>N. Modadugu</a>, "<a href="http://tools.ietf.org/html/rfc6347">Datagram Transport Layer Security Version 1.2</a>", RFC 6347, DOI 10.17487/RFC6347, January 2012.</td>
    </tr>
    <tr>
      <td class="reference">
        <b id="RFC6643">[RFC6643]</b>
      </td>
      <td class="top"><a>Schoenwaelder, J.</a>, "<a href="http://tools.ietf.org/html/rfc6643">Translation of Structure of Management Information Version 2 (SMIv2) MIB Modules to YANG Modules</a>", RFC 6643, DOI 10.17487/RFC6643, July 2012.</td>
    </tr>
    <tr>
      <td class="reference">
        <b id="RFC6690">[RFC6690]</b>
      </td>
      <td class="top"><a>Shelby, Z.</a>, "<a href="http://tools.ietf.org/html/rfc6690">Constrained RESTful Environments (CoRE) Link Format</a>", RFC 6690, DOI 10.17487/RFC6690, August 2012.</td>
    </tr>
    <tr>
      <td class="reference">
        <b id="RFC7159">[RFC7159]</b>
      </td>
      <td class="top"><a>Bray, T.</a>, "<a href="http://tools.ietf.org/html/rfc7159">The JavaScript Object Notation (JSON) Data Interchange Format</a>", RFC 7159, DOI 10.17487/RFC7159, March 2014.</td>
    </tr>
    <tr>
      <td class="reference">
        <b id="RFC7223">[RFC7223]</b>
      </td>
      <td class="top"><a>Bjorklund, M.</a>, "<a href="http://tools.ietf.org/html/rfc7223">A YANG Data Model for Interface Management</a>", RFC 7223, DOI 10.17487/RFC7223, May 2014.</td>
    </tr>
    <tr>
      <td class="reference">
        <b id="RFC7317">[RFC7317]</b>
      </td>
      <td class="top"><a>Bierman, A.</a> and <a>M. Bjorklund</a>, "<a href="http://tools.ietf.org/html/rfc7317">A YANG Data Model for System Management</a>", RFC 7317, DOI 10.17487/RFC7317, August 2014.</td>
    </tr>
    <tr>
      <td class="reference">
        <b id="I-D.ietf-core-interfaces">[I-D.ietf-core-interfaces]</b>
      </td>
      <td class="top"><a>Shelby, Z.</a>, <a>Vial, M.</a>, <a>Koster, M.</a> and <a>C. Groves</a>, "<a href="http://tools.ietf.org/html/draft-ietf-core-interfaces-07">Reusable Interface Definitions for Constrained RESTful Environments</a>", Internet-Draft draft-ietf-core-interfaces-07, December 2016.</td>
    </tr>
    <tr>
      <td class="reference">
        <b id="I-D.ietf-core-sid">[I-D.ietf-core-sid]</b>
      </td>
      <td class="top"><a>Somaraju, A.</a>, <a>Veillette, M.</a>, <a>Pelov, A.</a>, <a>Turner, R.</a> and <a>A. Minaburo</a>, "<a href="http://tools.ietf.org/html/draft-ietf-core-sid-00">YANG Schema Item iDentifier (SID)</a>", Internet-Draft draft-ietf-core-sid-00, October 2016.</td>
    </tr>
    <tr>
      <td class="reference">
        <b id="I-D.veillette-core-cool">[I-D.veillette-core-cool]</b>
      </td>
      <td class="top"><a>Veillette, M.</a>, <a>Pelov, A.</a>, <a>Somaraju, A.</a>, <a>Turner, R.</a> and <a>A. Minaburo</a>, "<a href="http://tools.ietf.org/html/draft-veillette-core-cool-02">Constrained Objects Language</a>", Internet-Draft draft-veillette-core-cool-02, July 2016.</td>
    </tr>
    <tr>
      <td class="reference">
        <b id="I-D.veillette-core-cool-library">[I-D.veillette-core-cool-library]</b>
      </td>
      <td class="top"><a>Veillette, M.</a>, "<a href="http://tools.ietf.org/html/draft-veillette-core-cool-library-00">Constrained YANG Module Library</a>", Internet-Draft draft-veillette-core-cool-library-00, August 2016.</td>
    </tr>
    <tr>
      <td class="reference">
        <b id="XML">[XML]</b>
      </td>
      <td class="top"><a>W3C</a>, "<a>Extensible Markup Language (XML)</a>", Web http://www.w3.org/xml</td>
    </tr>
    <tr>
      <td class="reference">
        <b id="OMA">[OMA]</b>
      </td>
      <td class="top"><a>Open Mobile Alliance (OMA)</a>, "<a>OMA-TS-LightweightM2M-V1_0-20131210-C</a>", Web http://technical.openmobilealliance.org/Technical/current_releases.aspx</td>
    </tr>
    <tr>
      <td class="reference">
        <b id="OMNA">[OMNA]</b>
      </td>
      <td class="top"><a>Open Mobile Alliance (OMA)</a>, "<a>Open Mobile Naming Authority (OMNA)</a>", Web http://http://technical.openmobilealliance.org/Technical/technical-information/omna</td>
    </tr>
    <tr>
      <td class="reference">
        <b id="netconfcentral">[netconfcentral]</b>
      </td>
      <td class="top"><a>YUMAworks</a>, "<a>NETCONF Central: library of YANG modules</a>", Web http://www.netconfcentral.org/modulelist</td>
    </tr>
    <tr>
      <td class="reference">
        <b id="mibreg">[mibreg]</b>
      </td>
      <td class="top"><a>IANA</a>, "<a>Structure of Management Information (SMI) Numbers (MIB Module Registrations)</a>", Web http://www.iana.org/assignments/smi-numbers/smi-numbers.xhtml/</td>
    </tr>
    <tr>
      <td class="reference">
        <b id="yang-cbor">[yang-cbor]</b>
      </td>
      <td class="top"><a>Veillette, M.</a>, "<a>yang-cbor Registry</a>", Web https://github.com/core-wg/yang-cbor/tree/master/registry/</td>
    </tr>
  </tbody>
</table>
<h1 id="rfc.appendix.A"><a href="#rfc.appendix.A">Appendix A.</a> <a href="#EXSPEC" id="EXSPEC">YANG example specifications</a></h1>
<p id="rfc.section.A.p.1">This appendix shows 5 YANG example specifications taken over from as many existing YANG modules. The YANG modules are available from <a href="#netconfcentral">[netconfcentral]</a>. Each YANG item identifier is accompanied by its SID shown after the &#8220;//&#8221; comment sign, taken from <a href="#yang-cbor">[yang-cbor]</a>.</p>
<h1 id="rfc.appendix.A.1"><a href="#rfc.appendix.A.1">A.1.</a> <a href="#ietf-system" id="ietf-system">ietf-system</a></h1>
<p id="rfc.section.A.1.p.1">Excerpt of the YANG module ietf-system <a href="#RFC7317">[RFC7317]</a>.</p>
<pre>
module ietf-system {
  container system {                   // SID 1715
    container clock {                  // SID 1734
      choice timezone {
        case timezone-name {
          leaf timezone-name {         // SID 1735
            type timezone-name;
          }
        }
        case timezone-utc-offset {
          leaf timezone-utc-offset {   // SID 1736
            type int16 {
            }
          }
        }
      }
    }
    container ntp {                    // SID 1750
      leaf enabled {                   // SID 1751
        type boolean;
        default true;
      }
      list server {                    // SID 1752
        key name;
        leaf name {                    // SID 1755
          type string;
        }
        choice transport {
          case udp {
            container udp {            // SID 1757
              leaf address {           // SID 1758
                type inet:host;
              }
              leaf port {              // SID 1759
                type inet:port-number;
              }
            }
          }
        }
        leaf association-type {        // SID 1753
          type enumeration {
            enum server {
            }
            enum peer {
            }
            enum pool {
            }
          }
        }
        leaf iburst {                  // SID 1754
          type boolean;
        }
        leaf prefer {                  // SID 1756
          type boolean;
          default false;
        }
      }
    }
  container system-state {             // SID 1716
    container clock {                  // SID 1717
      leaf current-datetime {          // SID 1719
        type yang:date-and-time;
      }
      leaf boot-datetime {             // SID 1718
        type yang:date-and-time;
      }
    }
  }
}

</pre>
<h1 id="rfc.appendix.A.2"><a href="#rfc.appendix.A.2">A.2.</a> <a href="#server" id="server">server list</a></h1>
<p id="rfc.section.A.2.p.1">Taken over from <a href="#RFC7950">[RFC7950]</a> section 7.15.3.</p>
<pre>
module example-server-farm {
  yang-version 1.1;
  namespace "urn:example:server-farm";
  prefix "sfarm";

  import ietf-yang-types {
    prefix "yang";
  }

  list server {                        // SID 60000
    key name;
    leaf name {                        // SID 60001
      type string;
    }
    action reset {                     // SID 60002
      input {
        leaf reset-at {                // SID 60003
          type yang:date-and-time;
          mandatory true;
         }
       }
       output {
         leaf reset-finished-at {      // SID 60004
           type yang:date-and-time;
           mandatory true;
         }
       }
     }
   }
}

</pre>
<h1 id="rfc.appendix.A.3"><a href="#rfc.appendix.A.3">A.3.</a> <a href="#interfaces" id="interfaces">interfaces</a></h1>
<p id="rfc.section.A.3.p.1">Excerpt of the YANG module ietf-interfaces <a href="#RFC7223">[RFC7223]</a>.</p>
<pre>
module ietf-interfaces {
  container interfaces {               // SID 1505
    list interface {                   // SID 1533
      key "name";
      leaf name {                      // SID 1537
        type string;
      }
      leaf description {               // SID 1534
        type string;
      }
      leaf type {                      // SID 1538
        type identityref {
          base interface-type;
        }
        mandatory true;
      }

      leaf enabled {                   // SID 1535
        type boolean;
        default "true";
      }

      leaf link-up-down-trap-enable {  // SID 1536
        if-feature if-mib;
        type enumeration {
          enum enabled {
            value 1;
          }
          enum disabled {
            value 2;
          }
        }
      }
    }
  }
}

</pre>
<h1 id="rfc.appendix.A.4"><a href="#rfc.appendix.A.4">A.4.</a> <a href="#notify-ex" id="notify-ex">Example-port</a></h1>
<p id="rfc.section.A.4.p.1">Notification example defined within this document.</p>
<pre>
module example-port {
        ...
        notification example-port-fault {   // SID 60010
          description
            "Event generated if a hardware fault on a
             line card port is detected";
          leaf port-name {                  // SID 60011
            type string;
            description "Port name";
          }
          leaf port-fault {                 // SID 60012
            type string;
            description "Error condition detected";
          }
        }
      }
</pre>
<h1 id="rfc.appendix.A.5"><a href="#rfc.appendix.A.5">A.5.</a> <a href="#SMI" id="SMI">IP-MIB</a></h1>
<p id="rfc.section.A.5.p.1">The YANG translation of the SMI specifying the IP-MIB <a href="#RFC4293">[RFC4293]</a>, extended with example SID numbers, yields:</p>
<pre>
module IP-MIB {
  import IF-MIB {
    prefix if-mib;
  }
  import INET-ADDRESS-MIB {
    prefix inet-address;
  }
  import SNMPv2-TC {
    prefix smiv2;
  }
  import ietf-inet-types {
    prefix inet;
  }
  import yang-smi {
    prefix smi;
  }
  import ietf-yang-types {
    prefix yang;
  }

  container ip {                            // SID 60020
    list ipNetToPhysicalEntry {             // SID 60021
      key "ipNetToPhysicalIfIndex ipNetToPhysicalNetAddressType ipNetToPhysicalNetAddress";
      leaf ipNetToPhysicalIfIndex {         // SID 60022
        type if-mib:InterfaceIndex;
      }
      leaf ipNetToPhysicalNetAddressType {  // SID 60023
        type inet-address:InetAddressType;
      }
      leaf ipNetToPhysicalNetAddress {      // SID 60024
        type inet-address:InetAddress;
      }
      leaf ipNetToPhysicalPhysAddress {     // SID 60025
        type yang:phys-address {
          length "0..65535";
        }
      }
      leaf ipNetToPhysicalLastUpdated {     // SID 60026
        type yang:timestamp;
      }
      leaf ipNetToPhysicalType {            // SID 60027
        type enumeration {
          enum "other" {
            value 1;
          }
          enum "invalid" {
            value 2;
          }
          enum "dynamic" {
            value 3;
          }
          enum "static" {
            value 4;
          }
          enum "local" {
            value 5;
          }
        }
      }
      leaf ipNetToPhysicalState {           // SID 60028
        type enumeration {
          enum "reachable" {
            value 1;
          }
          enum "stale" {
            value 2;
          }
          enum "delay" {
            value 3;
          }
          enum "probe" {
            value 4;
          }
          enum "invalid" {
            value 5;
          }
          enum "unknown" {
            value 6;
          }
          enum "incomplete" {
            value 7;
          }
        }
      }
      leaf ipNetToPhysicalRowStatus {       // SID 60029
        type smiv2:RowStatus;
    }  // list ipNetToPhysicalEntry
  }  // container ip
}  // module IP-MIB

</pre>
<h1 id="rfc.appendix.B"><a href="#rfc.appendix.B">Appendix B.</a> <a href="#LWM2M" id="LWM2M">Comparison with LWM2M</a></h1>
<h1 id="rfc.appendix.B.1"><a href="#rfc.appendix.B.1">B.1.</a> <a href="#LWM2M-introduction" id="LWM2M-introduction">Introduction</a></h1>
<p id="rfc.section.B.1.p.1">CoMI and LWM2M <a href="#OMA">[OMA]</a>, both, provide RESTful device management services over CoAP. Differences between the designs are highlighted in this section.</p>
<p id="rfc.section.B.1.p.2">The intent of the LWM2M protocol is to provide a single protocol to control and manage IoT devices. This means the IoT device implements and uses the same LWM2M agent function for the actuation and sensing features of the IoT device as well as for the management of the IoT device. The intent of CoMI Interface as described in the Abstract section of this document is to provide management of constrained devices and devices in constrained networks using RESTCONF and YANG. This implies that the device, although reusing the CoAP protocol, would need a separate CoAP based agent in the future to control the actuation and sensing features of the device and another CoMI agent that performs the management functions.</p>
<p id="rfc.section.B.1.p.3">It should be noted that the mapping of a LWM2M server to YANG is specified in [YANGlwm2m]. The converted server can be invoked with CoMI as specified in this document.</p>
<p id="rfc.section.B.1.p.4">For the purposes of managing IoT devices the following points related to the protocols compare how management resources are defined, identified, encoded and updated.</p>
<h1 id="rfc.appendix.B.2"><a href="#rfc.appendix.B.2">B.2.</a> <a href="#defining-management-resources" id="defining-management-resources">Defining Management Resources</a></h1>
<p id="rfc.section.B.2.p.1">Management resources in LWM2M (LWM2M objects) are defined using a standardized number. When a new management resource is defined, either by a standards organization or a private enterprise, the management resource is registered with the Open Mobile Naming Authority <a href="#OMNA">[OMNA]</a> in order to ensure different resource definitions do not use the same identifier.  CoMI, by virtue of using YANG as its data modeling language, allows enterprises and standards organizations to define new management resources (YANG nodes) within YANG modules without having to register each individual management resource. Instead YANG modules are scoped within a registered name space.  As such, the CoMI approach provides additional flexibility in defining management resources. Likewise, since CoMI utilizes YANG, existing YANG modules can be reused. The flexibility and reuse capabilities afforded to CoMI can be useful in management of devices like routers and switches in constrained networks. However for management of IoT devices, the usefulness of this flexibility and applicability of reuse of existing YANG modules may not be warranted.  The reason is that IoT devices typically do not require complex sets of configuration or monitoring operations required by devices like a router or a switch. To date, OMA has defined approximately 15 management resources for constrained and non-constrained mobile or fixed IoT devices while other 3rd Party SDOs have defined another 10 management resources for their use in non-constrained IoT devices. Likewise, the Constrained Object Language <a href="#I-D.veillette-core-cool">[I-D.veillette-core-cool]</a> which is used by CoMI when managing constrained IoT devices uses YANG schema item identifiers, which are registered with IANA, in order to define management resources that are encoded using CBOR when targeting constrained IoT Devices.</p>
<h1 id="rfc.appendix.B.3"><a href="#rfc.appendix.B.3">B.3.</a> <a href="#identifying-management-resources" id="identifying-management-resources">Identifying Management Resources</a></h1>
<p id="rfc.section.B.3.p.1">As LWM2M and CoMI can similarly be used to manage IoT devices, comparison of the CoAP URIs used to identify resources is relevant as the size of the resource URI becomes applicable for IoT devices in constrained networks.  LWM2M uses a flat identifier structure to identify management resources and are identified using the LWM2M object&#8217;s identifier, instance identifier and optionally resource identifier (for access to and object&#8217;s attributes). For example, identifier of a device object (object id = 3) would be &#8220;/3/0&#8221; and identification of the device object&#8217;s manufacturer attribute would be &#8220;/3/0/0&#8221;.  Effectively LWM2M identifiers for management resources are between 4 and 10 bytes in length.</p>
<p id="rfc.section.B.3.p.2">CoMI is expected to be used to manage constrained IoT devices. CoMI utilizes the YANG schema item identifier[SID] that identify the resources. CoMI recommends that IoT device expose resources to identify the data stores and event streams of the CoMI agent. Individual resources (e.g., device object) are not directly identified but are encoded within the payload. As such the identifier of the CoMI resource is smaller (4 to 7 bytes) but the overall payload size isn&#8217;t smaller as resource identifiers are encoded on the payload.</p>
<h1 id="rfc.appendix.B.4"><a href="#rfc.appendix.B.4">B.4.</a> <a href="#encoding-of-management-resources" id="encoding-of-management-resources">Encoding of Management Resources</a></h1>
<p id="rfc.section.B.4.p.1">LWM2M provides a separation of the definition of the management resources from how the payloads are encoded. As of the writing of this document LWM2M encodes LWM2M encodes payload data in Type-length-value (TLV), JSON or plain text formats. JSON encoding is the most common encoding scheme with TLV encoding used on the simplest IoT devices. CoMI&#8217;s use of CBOR provides a more efficient transfer mechanism <a href="#RFC7049">[RFC7049]</a> than the current LWM2M encoding formats.</p>
<p id="rfc.section.B.4.p.2">In situations where resources need to be modified, CoMI uses the CoAP PATCH operation resources only require a partial update. LWM2M does not currently use the CoAP PATCH operation but instead uses the CoAP PUT and POST operations which are less efficient.</p>
<h1 id="rfc.authors">
  <a href="#rfc.authors">Authors' Addresses</a>
</h1>
<div class="avoidbreak">
  <address class="vcard">
	<span class="vcardline">
	  <span class="fn">Peter van der Stok</span> 
	  <span class="n hidden">
		<span class="family-name">van der Stok</span>
	  </span>
	</span>
	<span class="org vcardline">consultant</span>
	<span class="adr">
	  
	  <span class="vcardline">
		<span class="locality"></span> 
		<span class="region"></span>
		<span class="code"></span>
	  </span>
	  <span class="country-name vcardline"></span>
	</span>
	<span class="vcardline">Phone: +31-492474673 (Netherlands), +33-966015248 (France)</span>

<span class="vcardline">EMail: <a href="mailto:consultancy@vanderstok.org">consultancy@vanderstok.org</a></span>

<span class="vcardline">URI: <a href="www.vanderstok.org">www.vanderstok.org</a></span>

  </address>
</div><div class="avoidbreak">
  <address class="vcard">
	<span class="vcardline">
	  <span class="fn">Andy Bierman</span> 
	  <span class="n hidden">
		<span class="family-name">Bierman</span>
	  </span>
	</span>
	<span class="org vcardline">YumaWorks</span>
	<span class="adr">
	  <span class="vcardline">685 Cochran St.</span>
<span class="vcardline">Suite #160</span>

	  <span class="vcardline">
		<span class="locality">Simi Valley</span>,  
		<span class="region">CA</span> 
		<span class="code">93065</span>
	  </span>
	  <span class="country-name vcardline">USA</span>
	</span>
	<span class="vcardline">EMail: <a href="mailto:andy@yumaworks.com">andy@yumaworks.com</a></span>

  </address>
</div><div class="avoidbreak">
  <address class="vcard">
	<span class="vcardline">
	  <span class="fn">Michel Veillette</span> 
	  <span class="n hidden">
		<span class="family-name">Veillette</span>
	  </span>
	</span>
	<span class="org vcardline">Trilliant Networks Inc.</span>
	<span class="adr">
	  <span class="vcardline">610 Rue du Luxembourg</span>

	  <span class="vcardline">
		<span class="locality">Granby</span>,  
		<span class="region">Quebec</span> 
		<span class="code">J2J 2V2</span>
	  </span>
	  <span class="country-name vcardline">Canada</span>
	</span>
	<span class="vcardline">Phone: +14503750556</span>

<span class="vcardline">EMail: <a href="mailto:michel.veillette@trilliantinc.com">michel.veillette@trilliantinc.com</a></span>

  </address>
</div><div class="avoidbreak">
  <address class="vcard">
	<span class="vcardline">
	  <span class="fn">Alexander Pelov</span> 
	  <span class="n hidden">
		<span class="family-name">Pelov</span>
	  </span>
	</span>
	<span class="org vcardline">Acklio</span>
	<span class="adr">
	  <span class="vcardline">2bis rue de la Chataigneraie</span>

	  <span class="vcardline">
		<span class="locality">Cesson-Sevigne</span>,  
		<span class="region">Bretagne</span> 
		<span class="code">35510</span>
	  </span>
	  <span class="country-name vcardline">France</span>
	</span>
	<span class="vcardline">EMail: <a href="mailto:a@ackl.io">a@ackl.io</a></span>

  </address>
</div>

</body>
</html>
